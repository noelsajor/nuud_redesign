<!-- Wavy Feed Section -->
<section class="wavy-feed"
         role="region"
         aria-labelledby="wavy-feed-title"
         style="background: {% if section.settings.use_gradient %}{{ section.settings.background_gradient }}{% else %}{{ section.settings.background_color }}{% endif %};
                padding: {{ section.settings.section_padding_top }}px 20px {{ section.settings.section_padding_bottom }}px 20px;">

  <!-- Top Wave -->
  {% if section.settings.show_top_wave %}
    <div class="wave-top"
         style="top: -{{ section.settings.wave_overlap_top }}px; height: {{ section.settings.wave_overlap_top }}px;"
         aria-hidden="true">
      <svg viewBox="0 0 1440 100"
           fill="none"
           xmlns="http://www.w3.org/2000/svg"
           preserveAspectRatio="none"
           role="presentation"
           focusable="false">
        <path d="M0,100 Q720,0 1440,100 Z" fill="{{ section.settings.wave_color }}"/>
      </svg>
    </div>
  {% endif %}

  <!-- Content -->
  <div class="feed-container" style="max-width: {{ section.settings.container_width }}px;">
    {% if section.settings.section_title != blank %}
      <h2 id="wavy-feed-title"
          style="color: {{ section.settings.title_color }}; font-size: {{ section.settings.title_size }}px; text-align: {{ section.settings.title_alignment }};">
        {{ section.settings.section_title }}
      </h2>
    {% endif %}

    <div class="feed-grid" role="list">
      {%- for block in section.blocks -%}
        {%- assign img = block.settings.image -%}
        <a class="feed-card"
           {% if block.settings.link != blank %}href="{{ block.settings.link }}"{% else %}role="link" aria-disabled="true"{% endif %}
           {{ block.shopify_attributes }}>
          <div class="feed-thumb" style="--ratio: {{ section.settings.aspect_ratio | default: 1 }}">
            {% if img != blank %}
              {% assign img_url = img | image_url: width: 1200 %}
              {{ img_url | image_tag:
                alt: block.settings.alt_text,
                loading: 'lazy',
                widths: '360, 600, 900, 1200',
                sizes: '(max-width: 749px) 45vw, (max-width: 989px) 30vw, 260px',
                class: 'feed-img'
              }}
            {% else %}
              {{ 'image' | placeholder_svg_tag: 'feed-placeholder' }}
            {% endif %}
          </div>
        </a>
      {%- endfor -%}
    </div>
  </div>

  <!-- Bottom Wave -->
  {% if section.settings.show_bottom_wave %}
    <div class="wave-bottom"
         style="bottom: -{{ section.settings.wave_overlap_bottom }}px; height: {{ section.settings.wave_overlap_bottom }}px;"
         aria-hidden="true">
      <svg viewBox="0 0 1440 100"
           fill="none"
           xmlns="http://www.w3.org/2000/svg"
           preserveAspectRatio="none"
           role="presentation"
           focusable="false">
        <path d="M0,0 Q720,100 1440,0 Z" fill="{{ section.settings.wave_color }}"/>
      </svg>
    </div>
  {% endif %}
</section>

<style>
.wavy-feed {
  position: relative;
  overflow: visible;
  z-index: 1;
}
.wave-top,
.wave-bottom {
  position: absolute;
  left: 0;
  width: 100%;
  line-height: 0;
  pointer-events: none;
  z-index: 2;
}
.wave-top svg,
.wave-bottom svg {
  width: 100%;
  height: 100%;
  display: block;
}
.feed-container {
  position: relative;
  z-index: 3;
  margin: 0 auto;
  width: 100%;
}
.feed-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
}
.feed-card {
  display: block;
  text-decoration: none;
}
.feed-thumb {
  position: relative;
  width: 100%;
  padding-top: calc(var(--ratio) * 100%);
  overflow: hidden;
}
.feed-img {
  position: absolute;
  top: 0; left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
}
</style>

{% schema %}
{
  "name": "Wavy Feed",
  "settings": [
    {
      "type": "checkbox",
      "id": "use_gradient",
      "label": "Use Gradient Background",
      "default": true
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#ffc4e1"
    },
    {
      "type": "color_background",
      "id": "background_gradient",
      "label": "Background Gradient",
      "default": "linear-gradient(135deg, #ffc4e1 0%, #b4d5ff 100%)"
    },
    {
      "type": "range",
      "id": "section_padding_top",
      "label": "Padding Top",
      "min": 0,
      "max": 250,
      "step": 10,
      "default": 80,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "section_padding_bottom",
      "label": "Padding Bottom",
      "min": 0,
      "max": 250,
      "step": 10,
      "default": 80,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "container_width",
      "label": "Container Max Width",
      "min": 800,
      "max": 1400,
      "step": 100,
      "default": 1200,
      "unit": "px"
    },
    {
      "type": "text",
      "id": "section_title",
      "label": "Section Title"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title Color",
      "default": "#8b1538"
    },
    {
      "type": "range",
      "id": "title_size",
      "label": "Title Font Size",
      "min": 20,
      "max": 48,
      "step": 2,
      "default": 32,
      "unit": "px"
    },
    {
      "type": "select",
      "id": "title_alignment",
      "label": "Title Alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ],
      "default": "center"
    },
    {
      "type": "checkbox",
      "id": "show_top_wave",
      "label": "Show Top Wave",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_bottom_wave",
      "label": "Show Bottom Wave",
      "default": true
    },
    {
      "type": "color",
      "id": "wave_color",
      "label": "Wave Color",
      "default": "#ffd4e5"
    },
    {
      "type": "range",
      "id": "wave_overlap_top",
      "label": "Top Wave Height",
      "min": 20,
      "max": 200,
      "step": 10,
      "default": 100,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "wave_overlap_bottom",
      "label": "Bottom Wave Height",
      "min": 20,
      "max": 200,
      "step": 10,
      "default": 100,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "aspect_ratio",
      "label": "Image Aspect Ratio",
      "min": 0.5,
      "max": 2.0,
      "step": 0.1,
      "default": 1.0
    }
  ],
  "blocks": [
    {
      "type": "image",
      "name": "Feed Image",
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Image" },
        { "type": "text", "id": "alt_text", "label": "Alt Text" },
        { "type": "url", "id": "link", "label": "Link URL" }
      ]
    }
  ],
  "presets": [
    { "name": "Wavy Feed" }
  ]
}
{% endschema %}