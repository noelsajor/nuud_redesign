<!-- SEO & Accessibility Optimized FAQ Section (arranged like the Waves example) -->
<section class="faq-section {{ 'faq-root-' | append: block.id | replace: '_', '' | downcase }}"
         role="region"
         aria-labelledby="faq-title-{{ block.id | replace: '_', '' | downcase }}"
         style="
           {% if block.settings.section_background_image %}
             background-image: url('{{ block.settings.section_background_image | image_url: width: 2000 }}');
             background-size: cover;
             background-position: center;
             background-repeat: no-repeat;
           {% else %}
             background: {{ block.settings.section_background_color }};
           {% endif %}
           padding: 60px {{ settings.gutter_width }}px 60px {{ settings.gutter_width }}px;
         "
         {{ block.shopify_attributes }}>

  {%- assign faq_uid = block.id | replace: '_', '' | downcase -%}

  {%- comment -%} Parse per-corner border radius CSV (tl,tr,br,bl) with sane fallbacks {%- endcomment -%}
  {%- assign br_vals = block.settings.question_border_radius_custom | split: ',' -%}
  {%- assign top_left     = br_vals[0] | default: '6' | strip -%}
  {%- assign top_right    = br_vals[1] | default: top_left  | strip -%}
  {%- assign bottom_right = br_vals[2] | default: top_left  | strip -%}
  {%- assign bottom_left  = br_vals[3] | default: top_right | strip -%}

  <!-- Optional Section Overlay (kept off by default via opacity=0) -->
  {% if block.settings.section_background_image and block.settings.overlay_opacity > 0 %}
    <div class="faq-section-overlay-{{ faq_uid }}"
         aria-hidden="true"
         style="
           position:absolute; inset:0;
           background-color: {{ block.settings.overlay_color }};
           opacity: {{ block.settings.overlay_opacity | divided_by: 100.0 }};
           pointer-events:none;
         ">
    </div>
  {% endif %}

  <!-- FAQ Container (matches theme container width & internal padding) -->
  <faq-section-{{ faq_uid }}
      class="faq-container-{{ faq_uid }}"
      style="
        max-width: {{ settings.container_width }}px;
        margin: 0 auto;
        padding-top: {{ block.settings.section_padding }}px;
        padding-bottom: {{ block.settings.section_padding }}px;
        {% if block.settings.container_background_image %}
          background-image: url('{{ block.settings.container_background_image | image_url: width: 1500 }}');
          background-size: cover;
          background-position: center;
          background-repeat: no-repeat;
        {% else %}
          background-color: {{ block.settings.background_color }};
        {% endif %}
        border-radius: {{ block.settings.border_radius }}px;
      ">

    <!-- Left Column: Subheading, Heading, Body -->
    <div class="faq-content-{{ faq_uid }}">
      {% if block.settings.subheading != blank %}
        <p class="faq-subheading-{{ faq_uid }}"
           style="color: {{ block.settings.subheading_color }}; font-size: {{ block.settings.subheading_size }}px;">
          {{ block.settings.subheading }}
        </p>
      {% endif %}

      {% if block.settings.heading != blank %}
        <h2 id="faq-title-{{ faq_uid }}"
            class="faq-heading-{{ faq_uid }}"
            style="color: {{ block.settings.heading_color }}; font-size: {{ block.settings.heading_size }}px;">
          {{ block.settings.heading }}
        </h2>
      {% else %}
        <!-- SR-only fallback title to ensure region is labelled -->
        <h2 id="faq-title-{{ faq_uid }}" class="sr-only">Frequently Asked Questions</h2>
      {% endif %}

      {% if block.settings.body != blank %}
        <div class="faq-body-{{ faq_uid }}"
             style="color: {{ block.settings.body_color }}; font-size: {{ block.settings.body_size }}px;">
          {{ block.settings.body }}
        </div>
      {% endif %}
    </div>

    <!-- Right Column: Questions List -->
    <ul class="faq-questions-{{ faq_uid }}" role="list">
      {% for i in (1..6) %}
        {% assign q_key = 'question_' | append: i %}
        {% assign a_key = 'answer_'   | append: i %}
        {% assign q = block.settings[q_key] %}
        {% assign a = block.settings[a_key] %}
        {% if q != blank and a != blank %}
          <li class="faq-item-{{ faq_uid }}"
              data-faq-item="{{ i }}"
              style="
                border: 1px solid {{ block.settings.question_border_color }};
                border-radius: {{ top_left }}px {{ top_right }}px {{ bottom_right }}px {{ bottom_left }}px;
                background-color: {{ block.settings.question_background }};
              ">
            <button class="faq-question-button-{{ faq_uid }}"
                    type="button"
                    aria-expanded="false"
                    aria-controls="faq-answer-{{ faq_uid }}-{{ i }}"
                    id="faq-question-{{ faq_uid }}-{{ i }}"
                    style="
                      color: {{ block.settings.question_color }};
                      font-size: {{ block.settings.question_size }}px;
                      padding: {{ block.settings.question_padding }}px;
                    ">
              <span class="faq-question-text-{{ faq_uid }}">{{ q }}</span>
              <svg class="faq-icon-{{ faq_uid }}"
                   viewBox="0 0 24 24"
                   fill="none"
                   stroke="currentColor"
                   stroke-width="2"
                   aria-hidden="true"
                   focusable="false">
                <polyline points="6,9 12,15 18,9"></polyline>
              </svg>
            </button>

            <div class="faq-answer-{{ faq_uid }}"
                 id="faq-answer-{{ faq_uid }}-{{ i }}"
                 role="region"
                 aria-labelledby="faq-question-{{ faq_uid }}-{{ i }}"
                 aria-hidden="true"
                 hidden
                 style="background-color: {{ block.settings.answer_background }};">
              <div class="faq-answer-content-{{ faq_uid }}"
                   style="
                     color: {{ block.settings.answer_color }};
                     font-size: {{ block.settings.answer_size }}px;
                     padding-left: {{ block.settings.question_padding }}px;
                     padding-right: {{ block.settings.question_padding }}px;
                   ">
                {{ a }}
              </div>
            </div>
          </li>
        {% endif %}
      {% endfor %}
    </ul>
  </faq-section-{{ faq_uid }}>
</section>

<style>
/* Base Section */
.faq-section { position: relative; z-index: 1; }

/* Grid container: 2 cols â†’ 1 col on mobile */
.faq-container-{{ faq_uid }}{
  position: relative; z-index: 2;
  display: grid; grid-template-columns: 1fr 1fr;
  gap: {{ block.settings.section_gap }}px;
  padding-left: {{ settings.gutter_width }}px;
  padding-right: {{ settings.gutter_width }}px;
}
.faq-content-{{ faq_uid }}{ display:flex; flex-direction:column; gap:16px; }

.faq-questions-{{ faq_uid }}{
  display:flex; flex-direction:column;
  gap: {{ block.settings.question_gap }}px;
  list-style:none; margin:0; padding:0;
}

/* Question button: keyboard-visible focus; no hover effects */
.faq-question-button-{{ faq_uid }}{
  width:100%; background:transparent; border:0; text-align:left;
  display:flex; justify-content:space-between; align-items:center; gap:1rem;
  line-height:1.4; font-weight:700; cursor:pointer;
}
.faq-question-button-{{ faq_uid }}:focus-visible{
  outline: 2px solid rgba(0,0,0,.6);
  outline-offset: 2px;
  border-radius: {{ top_left }}px {{ top_right }}px {{ bottom_right }}px {{ bottom_left }}px;
}

/* Icon rotation on open */
.faq-icon-{{ faq_uid }}{ width:20px; height:20px; transition: transform .25s ease; flex:0 0 auto; color: {{ block.settings.icon_color }}; }
.faq-item-{{ faq_uid }}.active .faq-icon-{{ faq_uid }}{ transform: rotate(180deg); }

/* Answer panel animation */
.faq-answer-{{ faq_uid }}{
  max-height:0; overflow:hidden; transition: max-height .25s ease, padding .25s ease;
}
.faq-answer-content-{{ faq_uid }}{ line-height:1.65; }
.faq-item-{{ faq_uid }}.active .faq-answer-{{ faq_uid }}{
  max-height:500px; padding-top: {{ block.settings.answer_padding }}px; padding-bottom: {{ block.settings.answer_padding }}px;
}

/* Responsiveness (match theme breakpoints) */
@media screen and (max-width: {{ settings.lap_container_width }}px){
  .faq-container-{{ faq_uid }}{ max-width: {{ settings.lap_container_width }}px; }
}
@media screen and (max-width: {{ settings.tab_container_width }}px){
  .faq-container-{{ faq_uid }}{
    max-width: {{ settings.tab_container_width }}px;
    padding-left: calc({{ settings.gutter_width }}px * .8);
    padding-right: calc({{ settings.gutter_width }}px * .8);
  }
}
@media (prefers-reduced-motion: reduce){
  .faq-icon-{{ faq_uid }}, .faq-answer-{{ faq_uid }}{ transition: none !important; }
}
@media (max-width: 768px){
  .faq-container-{{ faq_uid }}{
    grid-template-columns: 1fr;
    gap: {{ block.settings.mobile_gap }}px;
    padding-top: calc({{ block.settings.section_padding }}px * .8);
    padding-bottom: calc({{ block.settings.section_padding }}px * .8);
    padding-left: calc({{ settings.gutter_width }}px * .6);
    padding-right: calc({{ settings.gutter_width }}px * .6);
  }
  .faq-content-{{ faq_uid }}{ text-align: {{ block.settings.mobile_text_alignment }}; }
  .faq-subheading-{{ faq_uid }}{ font-size: calc({{ block.settings.subheading_size }}px * .9); }
  .faq-heading-{{ faq_uid }}{ font-size: calc({{ block.settings.heading_size }}px * .85); }
  .faq-body-{{ faq_uid }}{ font-size: calc({{ block.settings.body_size }}px * .95); }
  .faq-question-button-{{ faq_uid }}{
    padding: calc({{ block.settings.question_padding }}px * .85);
    font-size: calc({{ block.settings.question_size }}px * .95);
  }
  .faq-answer-content-{{ faq_uid }}{
    padding-left: calc({{ block.settings.question_padding }}px * .85);
    padding-right: calc({{ block.settings.question_padding }}px * .85);
    font-size: calc({{ block.settings.answer_size }}px * .95);
  }
  .faq-item-{{ faq_uid }}.active .faq-answer-{{ faq_uid }}{
    padding-top: calc({{ block.settings.answer_padding }}px * .85);
    padding-bottom: calc({{ block.settings.answer_padding }}px * .85);
  }
}

/* Screen Reader Only (matches your example utility) */
.sr-only{
  position:absolute; width:1px; height:1px; padding:0; margin:-1px;
  overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0;
}
</style>

<!-- Behavior: custom element (unchanged functionality) -->
<script>
  (function() {
    class FaqSection{{ faq_uid }} extends HTMLElement {
      connectedCallback(){ this.setup(); }
      setup(){
        const items = this.querySelectorAll('.faq-item-{{ faq_uid }}');
        items.forEach(item => {
          const btn = item.querySelector('.faq-question-button-{{ faq_uid }}');
          const panel = item.querySelector('.faq-answer-{{ faq_uid }}');
          if(!btn || !panel) return;
          btn.addEventListener('click', () => {
            const open = item.classList.contains('active');
            if(open){ this.close(item, btn, panel); } else { this.open(item, btn, panel); }
          });
        });
      }
      open(item, btn, panel){
        item.classList.add('active');
        btn.setAttribute('aria-expanded','true');
        panel.removeAttribute('hidden');
        panel.setAttribute('aria-hidden','false');
      }
      close(item, btn, panel){
        item.classList.remove('active');
        btn.setAttribute('aria-expanded','false');
        panel.setAttribute('aria-hidden','true');
        panel.setAttribute('hidden','');
      }
    }
    customElements.define('faq-section-{{ faq_uid }}', FaqSection{{ faq_uid }});
  })();
</script>

{%- comment -%} SEO: FAQPage JSON-LD (unchanged logic) {%- endcomment -%}
{% assign faq_entities = '' %}
{% capture faq_entities %}
[
  {% assign comma = '' %}
  {% for i in (1..6) %}
    {% assign q_key = 'question_' | append: i %}
    {% assign a_key = 'answer_'   | append: i %}
    {% assign q = block.settings[q_key] %}
    {% assign a = block.settings[a_key] %}
    {% if q != blank and a != blank %}
      {{ comma }}
      {
        "@type": "Question",
        "name": {{ q | strip_html | json }},
        "acceptedAnswer": { "@type": "Answer", "text": {{ a | json }} }
      }
      {% assign comma = ',' %}
    {% endif %}
  {% endfor %}
]
{% endcapture %}
{% if faq_entities contains '"Question"' %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": {{ faq_entities | strip }}
}
</script>
{% endif %}

{% schema %}
{
  "name": "FAQ section (A11y + SEO)",
  "settings": [
    { "type": "header", "content": "Content" },
    { "type": "text", "id": "subheading", "label": "Subheading", "default": "FAQ" },
    { "type": "text", "id": "heading", "label": "Heading", "default": "Frequently Asked Questions" },
    { "type": "richtext", "id": "body", "label": "Body text", "default": "<p>Find answers to the most common questions about our products and services.</p>" },

    { "type": "header", "content": "Questions" },
    { "type": "text", "id": "question_1", "label": "Question 1", "default": "What is your return policy?" },
    { "type": "richtext", "id": "answer_1", "label": "Answer 1", "default": "<p>We offer a 30-day return policy for all unused items in their original packaging.</p>" },
    { "type": "text", "id": "question_2", "label": "Question 2", "default": "How long does shipping take?" },
    { "type": "richtext", "id": "answer_2", "label": "Answer 2", "default": "<p>Standard shipping takes 3-5 business days. Express shipping is available for 1-2 business days.</p>" },
    { "type": "text", "id": "question_3", "label": "Question 3", "default": "Do you offer international shipping?" },
    { "type": "richtext", "id": "answer_3", "label": "Answer 3", "default": "<p>Yes, we ship to most countries worldwide. Shipping costs and delivery times vary by location.</p>" },
    { "type": "text", "id": "question_4", "label": "Question 4" },
    { "type": "richtext", "id": "answer_4", "label": "Answer 4" },
    { "type": "text", "id": "question_5", "label": "Question 5" },
    { "type": "richtext", "id": "answer_5", "label": "Answer 5" },
    { "type": "text", "id": "question_6", "label": "Question 6" },
    { "type": "richtext", "id": "answer_6", "label": "Answer 6" },

    { "type": "header", "content": "Section background" },
    { "type": "image_picker", "id": "section_background_image", "label": "Background image" },
    { "type": "color", "id": "section_background_color", "label": "Background color", "default": "#f8f8f8" },
    { "type": "color", "id": "overlay_color", "label": "Overlay color", "default": "#000000" },
    { "type": "range", "id": "overlay_opacity", "label": "Overlay opacity", "min": 0, "max": 80, "step": 5, "unit": "%", "default": 0 },

    { "type": "header", "content": "Container background" },
    { "type": "image_picker", "id": "container_background_image", "label": "Container background image" },
    { "type": "color", "id": "background_color", "label": "Container background color", "default": "#ffffff" },

    { "type": "header", "content": "Layout" },
    { "type": "range", "id": "section_padding", "label": "Section padding", "min": 20, "max": 80, "step": 5, "unit": "px", "default": 40 },
    { "type": "range", "id": "section_gap", "label": "Gap between content and questions", "min": 20, "max": 80, "step": 5, "unit": "px", "default": 40 },
    { "type": "range", "id": "mobile_gap", "label": "Mobile gap", "min": 15, "max": 50, "step": 5, "unit": "px", "default": 30 },
    {
      "type": "select",
      "id": "mobile_text_alignment",
      "label": "Mobile text alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ],
      "default": "left"
    },
    { "type": "range", "id": "question_gap", "label": "Gap between questions", "min": 5, "max": 30, "step": 1, "unit": "px", "default": 12 },
    { "type": "range", "id": "question_padding", "label": "Question padding", "min": 10, "max": 30, "step": 2, "unit": "px", "default": 20 },
    { "type": "range", "id": "answer_padding", "label": "Answer padding", "min": 10, "max": 30, "step": 2, "unit": "px", "default": 20 },
    { "type": "range", "id": "border_radius", "label": "Section border radius", "min": 0, "max": 30, "step": 2, "unit": "px", "default": 8 },

    {
      "type": "text",
      "id": "question_border_radius_custom",
      "label": "Question border radius (tl,tr,br,bl)",
      "default": "6,6,6,6",
      "info": "Enter values separated by commas: top-left, top-right, bottom-right, bottom-left (e.g., 16,8,16,8)"
    },

    { "type": "header", "content": "Colors" },
    { "type": "color", "id": "subheading_color", "label": "Subheading", "default": "#666666" },
    { "type": "color", "id": "heading_color", "label": "Heading", "default": "#000000" },
    { "type": "color", "id": "body_color", "label": "Body text", "default": "#333333" },
    { "type": "color", "id": "question_background", "label": "Question background", "default": "#f8f8f8" },
    { "type": "color", "id": "question_color", "label": "Question text", "default": "#000000" },
    { "type": "color", "id": "question_border_color", "label": "Question border", "default": "#e0e0e0" },
    { "type": "color", "id": "answer_background", "label": "Answer background", "default": "#ffffff" },
    { "type": "color", "id": "answer_color", "label": "Answer text", "default": "#555555" },
    { "type": "color", "id": "icon_color", "label": "Icon", "default": "#666666" },

    { "type": "header", "content": "Typography" },
    { "type": "range", "id": "subheading_size", "label": "Subheading size", "min": 12, "max": 24, "step": 1, "unit": "px", "default": 14 },
    { "type": "range", "id": "heading_size", "label": "Heading size", "min": 20, "max": 60, "step": 2, "unit": "px", "default": 36 },
    { "type": "range", "id": "body_size", "label": "Body text size", "min": 14, "max": 24, "step": 1, "unit": "px", "default": 16 },
    { "type": "range", "id": "question_size", "label": "Question text size", "min": 14, "max": 24, "step": 1, "unit": "px", "default": 16 },
    { "type": "range", "id": "answer_size", "label": "Answer text size", "min": 14, "max": 20, "step": 1, "unit": "px", "default": 15 }
  ],
  "presets": [{ "name": "FAQ section" }]
}
{% endschema %}
