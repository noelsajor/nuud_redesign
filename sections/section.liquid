<!-- Hero Section (image left/right + optional shadow) -->
<section class="hero-section"
         role="banner"
         aria-label="{{ section.settings.section_aria_label | default: 'Hero section with promotional content' }}"
         style="background-color: {{ section.settings.background_color }}; padding: 80px 40px;">
  {% assign pos = section.settings.image_position | default: 'left' %}
  {% assign ov = section.settings.image_overflow | default: 40 %}
  {% assign r = section.settings.card_border_radius | default: 20 %}
  {% assign ovdir = section.settings.image_overflow_direction | default: 'auto' %}

  {%- comment -%} Image|Content ratio mapping {%- endcomment -%}
  {% assign ratio = section.settings.layout_ratio | default: '1-1' %}
  {% case ratio %}
    {% when '1-4' %}{% assign image_fr = '1fr' %}{% assign content_fr = '4fr' %}
    {% when '1-3' %}{% assign image_fr = '1fr' %}{% assign content_fr = '3fr' %}
    {% when '2-3' %}{% assign image_fr = '2fr' %}{% assign content_fr = '3fr' %}
    {% when '1-2' %}{% assign image_fr = '1fr' %}{% assign content_fr = '2fr' %}
    {% when '1-1' %}{% assign image_fr = '1fr' %}{% assign content_fr = '1fr' %}
    {% when '3-2' %}{% assign image_fr = '3fr' %}{% assign content_fr = '2fr' %}
    {% when '3-1' %}{% assign image_fr = '3fr' %}{% assign content_fr = '1fr' %}
    {% when '4-1' %}{% assign image_fr = '4fr' %}{% assign content_fr = '1fr' %}
    {% else %}{% assign image_fr = '1fr' %}{% assign content_fr = '1fr' %}
  {% endcase %}

  {%- comment -%}
    Compute overflow side without parentheses (Liquid-safe).
    Outputs: img_ml, img_mr and img_w.
  {%- endcomment -%}
  {% assign img_ml = '0' %}
  {% assign img_mr = '0' %}
  {% assign img_w = '100%' %}

  {% if ov > 0 and ovdir != 'none' %}
    {% if pos == 'left' %}
      {% if ovdir == 'auto' or ovdir == 'outer' %}
        {% assign img_ml = '-' | append: ov | append: 'px' %}
        {% assign img_w = 'calc(100% + ' | append: ov | append: 'px)' %}
      {% elsif ovdir == 'inner' %}
        {% assign img_mr = '-' | append: ov | append: 'px' %}
        {% assign img_w = 'calc(100% + ' | append: ov | append: 'px)' %}
      {% endif %}
    {% else %}
      {% if ovdir == 'auto' or ovdir == 'outer' %}
        {% assign img_mr = '-' | append: ov | append: 'px' %}
        {% assign img_w = 'calc(100% + ' | append: ov | append: 'px)' %}
      {% elsif ovdir == 'inner' %}
        {% assign img_ml = '-' | append: ov | append: 'px' %}
        {% assign img_w = 'calc(100% + ' | append: ov | append: 'px)' %}
      {% endif %}
    {% endif %}
  {% endif %}

  <div class="hero-container">
    {% if section.settings.show_badge and section.settings.badge_image %}
      <div class="brand-badge">
        <img src="{{ section.settings.badge_image | image_url: width: 200 }}"
             alt="{{ section.settings.badge_alt | default: 'Brand Badge' }}"
             class="badge-image {% if section.settings.badge_spin %}badge-spin{% endif %}"
             style="width: {{ section.settings.badge_size }}px; height: {{ section.settings.badge_size }}px;"
             width="{{ section.settings.badge_size }}"
             height="{{ section.settings.badge_size }}"
             loading="lazy"
             decoding="async">
      </div>
    {% endif %}

    <article class="hero-card image-{{ pos }} {% if section.settings.enable_card_shadow %}has-shadow{% endif %}"
             style="border-color: {{ section.settings.border_color }};
                    border-width: {{ section.settings.border_width }}px;
                    border-radius: {{ r }}px;
                    background-color: {{ section.settings.card_background }};
                    {% if pos == 'left' %}margin-left: {{ ov }}px;{% else %}margin-right: {{ ov }}px;{% endif %}
                    --image-fr: {{ image_fr }}; --content-fr: {{ content_fr }};">

      <!-- Image -->
      <div class="hero-image-container">
        {% if section.settings.hero_image %}
          <img
            src="{{ section.settings.hero_image | image_url: width: 800 }}"
            srcset="{{ section.settings.hero_image | image_url: width: 400 }} 400w,
                    {{ section.settings.hero_image | image_url: width: 600 }} 600w,
                    {{ section.settings.hero_image | image_url: width: 800 }} 800w,
                    {{ section.settings.hero_image | image_url: width: 1000 }} 1000w"
            sizes="(max-width: 768px) 100vw, 50vw"
            alt="{{ section.settings.hero_image.alt | default: section.settings.hero_title | default: 'Hero promotional image' }}"
            class="hero-image"
            style="
              {% if img_ml != '0' %}margin-left: {{ img_ml }};{% endif %}
              {% if img_mr != '0' %}margin-right: {{ img_mr }};{% endif %}
              width: {{ img_w }};
              {% if pos == 'left' %}
                border-radius: {{ r }}px 0 0 {{ r }}px;
              {% else %}
                border-radius: 0 {{ r }}px {{ r }}px 0;
              {% endif %}
              height: 100%; object-fit: cover;"
            width="800"
            height="500"
            loading="eager"
            decoding="async"
            fetchpriority="high">
        {% else %}
          <div class="hero-image-placeholder"
               style="
                 {% if img_ml != '0' %}margin-left: {{ img_ml }};{% endif %}
                 {% if img_mr != '0' %}margin-right: {{ img_mr }};{% endif %}
                 width: {{ img_w }};
                 {% if pos == 'left' %}
                   border-radius: {{ r }}px 0 0 {{ r }}px;
                 {% else %}
                   border-radius: 0 {{ r }}px {{ r }}px 0;
                 {% endif %}
                 background-color: #f0f0f0;"
               role="img"
               aria-label="Placeholder for hero image">
            <span aria-hidden="true">Add your hero image</span>
          </div>
        {% endif %}
      </div>

      <!-- Content -->
      <header class="hero-content" style="background-color: {{ section.settings.content_background }};">
        {% if section.settings.hero_title != blank %}
          <h1 id="hero-title"
              class="hero-title"
              style="color: {{ section.settings.title_color }};
                     font-size: {{ section.settings.title_size }}px;
                     font-weight: {{ section.settings.title_weight }};">
            {{ section.settings.hero_title }}
          </h1>
        {% endif %}

        {% if section.settings.hero_description != blank %}
          <p class="hero-description"
             style="color: {{ section.settings.description_color }};
                    font-size: {{ section.settings.description_size }}px;">
            {{ section.settings.hero_description }}
          </p>
        {% endif %}

        {% if section.settings.button_text != blank %}
          <a href="{{ section.settings.button_url | default: '/collections/all' }}"
             class="hero-cta-button"
             style="background: {{ section.settings.button_background }};
                    color: {{ section.settings.button_text_color }};
                    border-radius: {{ section.settings.button_border_radius }}px;
                    font-size: {{ section.settings.button_text_size }}px;"
             {% if section.settings.button_url == blank %}aria-describedby="button-warning"{% endif %}
             rel="noopener">
            {{ section.settings.button_text }}
            <span class="sr-only"> - {{ section.settings.hero_title | default: 'Learn more' }}</span>
          </a>
          {% if section.settings.button_url == blank %}
            <div id="button-warning" class="sr-only">Button URL not set - links to collections page</div>
          {% endif %}
        {% endif %}
      </header>
    </article>
  </div>
</section>

<style>
/* Base */
.hero-section {
  position: relative;
  min-height: 600px;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Unified max-width wrapper at 1280px (centered) */
.hero-container { position: relative; max-width: 1280px; width: 100%; margin: 0 auto; }

/* Badge */
.brand-badge { position: absolute; right: 20px; z-index: 2; } /* keep above card */
.badge-image { border-radius: 50%; box-shadow: 0 4px 15px rgba(0,0,0,.1); display: block; }
.badge-spin { animation: spin {{ section.settings.badge_spin_speed | default: 10 }}s linear infinite; }
@keyframes spin { from { transform: rotate(0deg);} to { transform: rotate(360deg);} }
@media (prefers-reduced-motion: reduce){ .badge-spin{ animation:none; } .hero-cta-button{ transition:none; } }

/* Card (ratio-driven grid) */
.hero-card {
  border-style: solid;
  overflow: visible; /* allow child overflow */
  display: grid;
  align-content: center;
  /* FIX: allow columns to shrink to avoid overflow */
  grid-template-columns: minmax(0, var(--image-fr)) minmax(0, var(--content-fr));
  grid-template-areas: "image content";
  min-height: 500px;
  box-shadow: none; /* shadow controlled by .has-shadow */
}
.hero-card.has-shadow { box-shadow: 0 10px 30px rgba(0,0,0,.1); }

/* When image on the right, flip column sizes so image keeps its chosen width */
.hero-card.image-right {
  grid-template-columns: minmax(0, var(--content-fr)) minmax(0, var(--image-fr));
  grid-template-areas: "content image";
}

.hero-image-container { grid-area: image; position: relative; overflow: visible; } /* show overflow */
.hero-image { height: 100%; object-fit: cover; object-position: center; display: block; }
.hero-image-placeholder { width: 100%; height: 100%; display:flex; align-items:center; justify-content:center; color:#666; font-size:1.1rem; }

.hero-content {
  grid-area: content;
  padding: 60px 50px;
  display:flex;
  flex-direction:column;
  justify-content:center;

  /* FIXES for text overflow */
  min-width: 0;
  overflow: hidden;
  word-wrap: break-word;
  overflow-wrap: anywhere;
}

 /* Typography - inherit theme defaults */
.hero-title { margin: 0 0 24px 0; line-height: 1.1; max-width: 100%; overflow-wrap: anywhere; word-break: break-word; hyphens: auto; }
.hero-description { margin: 0 0 30px 0 !important; line-height: 1.6; max-width: 100%; overflow-wrap: anywhere; word-break: break-word; hyphens: auto; }

/* CTA */
.hero-cta-button {
  display: inline-block; padding: 16px 32px; text-decoration: none; font-weight: 600;
  transition: transform .3s ease, box-shadow .3s ease; align-self: flex-start; border: 2px solid transparent; cursor: pointer;

  /* overflow safety */
  white-space: normal;
  max-width: 100%;
  overflow: hidden;
  text-overflow: ellipsis;
}
.hero-cta-button:hover, .hero-cta-button:focus {
  transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,0,0,.2); text-decoration:none; outline:none;
}
.hero-cta-button:focus-visible { outline: 2px solid currentColor; outline-offset: 3px; border-color: currentColor; }

/* a11y helpers */
.sr-only{ position: absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }

/* High contrast */
@media (prefers-contrast: high){ .hero-card{ border-width:3px; } .hero-cta-button{ border:2px solid currentColor; } }

/* ---- Desktop: show overflow (so clipped parts are visible) ---- */
@media (min-width: 769px){
  .hero-container{ overflow: visible !important; }
  .hero-card{ overflow: visible !important; }
  .hero-image-container{ overflow: visible !important; }
  .brand-badge{ top: 16px; } /* keep badge nicely inside */
}

/* ------- Mobile fixes ------- */
@media (max-width: 768px){
  .hero-section { padding-left: 15px !important; padding-right: 15px !important; }
  .hero-container { margin: 0 auto; overflow: hidden; } /* keep mobile neat */

  .hero-card {
    display: flex !important;
    flex-direction: column !important;
    grid-template-columns: 1fr !important;
    grid-template-areas: "image" "content" !important;
    margin-left:0 !important; margin-right:0 !important;
    min-height: unset !important; /* let content define height */
  }

  /* Remove image overflow/cropping tricks on mobile */
  .hero-image, .hero-image-placeholder {
    margin-left: 0 !important; margin-right: 0 !important; width: 100% !important;
    height: auto !important;
    border-radius: {{ r }}px {{ r }}px 0 0 !important;
  }
  .hero-image-container { overflow: hidden; }

  .hero-content { padding: 32px 22px; }
  .hero-title { font-size: calc({{ section.settings.title_size | default: 48 }}px * 0.7) !important; margin-bottom: 18px; }
  .hero-description { font-size: calc({{ section.settings.description_size | default: 18 }}px * 0.92) !important; margin-bottom: 22px; }

  /* Make CTA full-width on mobile for easier taps */
  .hero-cta-button { width: 100%; text-align: center; align-self: stretch; }

  /* Keep badge but scale & tuck it safely */
  .brand-badge { top: -20px; right: 12px; }
  .badge-image { width: calc({{ section.settings.badge_size | default: 120 }}px * 0.8) !important; height: calc({{ section.settings.badge_size | default: 120 }}px * 0.8) !important; }
}

@media (max-width: 480px){
  .hero-content { padding: 26px 18px; }
  .hero-title {
    font-size: calc({{ section.settings.title_size | default: 48 }}px * 0.54) !important;

    /* gentle clamping to keep tiny screens tidy */
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  .hero-description {
    font-size: calc({{ section.settings.description_size | default: 18 }}px * 0.85) !important;

    display: -webkit-box;
    -webkit-line-clamp: 6;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  .hero-cta-button { padding: 14px 20px; font-size: calc({{ section.settings.button_text_size | default: 18 }}px * 0.95) !important; }
}

/* Print */
@media print{ .hero-section{ background:#fff !important; box-shadow:none !important; } .badge-spin{ animation:none !important; } }
</style>

{% schema %}
{
  "name": "Hero Section",
  "settings": [
    { "type": "header", "content": "Accessibility" },
    { "type": "text", "id": "section_aria_label", "label": "Section ARIA Label", "default": "Hero section with promotional content" },

    { "type": "header", "content": "Layout" },
    { "type": "color", "id": "background_color", "label": "Section Background Color", "default": "#f5f5f5" },
    { "type": "range", "id": "section_padding_top", "label": "Section Padding Top", "min": 0, "max": 100, "step": 5, "default": 60, "unit": "px" },
    { "type": "range", "id": "section_padding_bottom", "label": "Section Padding Bottom", "min": 0, "max": 100, "step": 5, "default": 60, "unit": "px" },

    { "type": "header", "content": "Card" },
    { "type": "color", "id": "card_background", "label": "Card Background Color", "default": "#ffffff" },
    { "type": "color", "id": "content_background", "label": "Content Area Background", "default": "#ffffff" },
    { "type": "color", "id": "border_color", "label": "Card Border Color", "default": "#ff69b4" },
    { "type": "range", "id": "border_width", "label": "Border Width", "min": 0, "max": 10, "step": 1, "default": 3, "unit": "px" },
    { "type": "range", "id": "card_border_radius", "label": "Card Border Radius", "min": 0, "max": 50, "step": 5, "default": 20, "unit": "px" },
    { "type": "checkbox", "id": "enable_card_shadow", "label": "Enable card drop shadow", "default": true },

    { "type": "header", "content": "Hero Image" },
    { "type": "image_picker", "id": "hero_image", "label": "Hero Image" },
    { "type": "select", "id": "image_position", "label": "Image position", "default": "left",
      "options": [
        { "value": "left", "label": "Left (image | content)" },
        { "value": "right", "label": "Right (content | image)" }
      ]
    },
    { "type": "range", "id": "image_overflow", "label": "Image Overflow Amount", "min": 0, "max": 80, "step": 10, "default": 40, "unit": "px" },

    { "type": "select",
      "id": "image_overflow_direction",
      "label": "Image Overflow Direction",
      "default": "auto",
      "options": [
        { "value": "auto", "label": "Auto (outer by image side)" },
        { "value": "outer", "label": "Outer (toward edge of card)" },
        { "value": "inner", "label": "Inner (toward content)" },
        { "value": "none", "label": "None (no overflow)" }
      ]
    },

    { "type": "select",
      "id": "layout_ratio",
      "label": "Image | Content ratio (desktop)",
      "default": "1-1",
      "options": [
        { "value": "1-4", "label": "1/5 | 4/5" },
        { "value": "1-3", "label": "1/4 | 3/4" },
        { "value": "2-3", "label": "2/5 | 3/5" },
        { "value": "1-2", "label": "1/3 | 2/3" },
        { "value": "1-1", "label": "1/2 | 1/2" },
        { "value": "3-2", "label": "3/5 | 2/5" },
        { "value": "3-1", "label": "3/4 | 1/4" },
        { "value": "4-1", "label": "4/5 | 1/5" }
      ]
    },

    { "type": "header", "content": "Title" },
    { "type": "text", "id": "hero_title", "label": "Hero Title (H1)", "default": "Enhance your play in bed" },
    { "type": "color", "id": "title_color", "label": "Title Color", "default": "#8b1538" },
    { "type": "range", "id": "title_size", "label": "Title Font Size", "min": 24, "max": 72, "step": 2, "default": 48, "unit": "px" },
    { "type": "select", "id": "title_weight", "label": "Title Font Weight",
      "options": [
        { "value": "300", "label": "Light" },
        { "value": "400", "label": "Normal" },
        { "value": "500", "label": "Medium" },
        { "value": "600", "label": "Semi Bold" },
        { "value": "700", "label": "Bold" },
        { "value": "800", "label": "Extra Bold" }
      ],
      "default": "700"
    },

    { "type": "header", "content": "Description" },
    { "type": "textarea", "id": "hero_description", "label": "Hero Description", "default": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation." },
    { "type": "color", "id": "description_color", "label": "Description Color", "default": "#333333" },
    { "type": "range", "id": "description_size", "label": "Description Font Size", "min": 14, "max": 24, "step": 1, "default": 18, "unit": "px" },

    { "type": "header", "content": "Call-to-Action Button" },
    { "type": "text", "id": "button_text", "label": "Button Text" },
    { "type": "url", "id": "button_url", "label": "Button URL" },
    { "type": "color", "id": "button_background", "label": "Button Background Color", "default": "#ff69b4" },
    { "type": "color", "id": "button_text_color", "label": "Button Text Color", "default": "#ffffff" },
    { "type": "range", "id": "button_text_size", "label": "Button Text Size", "min": 14, "max": 24, "step": 1, "default": 18, "unit": "px" },
    { "type": "range", "id": "button_border_radius", "label": "Button Border Radius", "min": 0, "max": 50, "step": 5, "default": 30, "unit": "px" }
  ],
  "presets": [
    { "name": "Hero Section", "category": "Custom" }
  ],
  "templates": ["index", "page", "collection", "product"]
}
{% endschema %}
