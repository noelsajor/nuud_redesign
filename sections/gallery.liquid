{% assign margin = section.settings.margin | split: ',' %}
{% assign margin_top = margin[0] %}
{% assign margin_bottom = margin[1] %}
{% assign padding = section.settings.padding | split: ',' %}
{% assign padding_top = padding[0] %}
{% assign padding_bottom = padding[1] %}

<section
  id="gallery-{{ section.id }}"
  data-section-id="{{ section.id }}"
  data-section-type="gallery_page"
  class="gallery_page {% if section.settings.enable_overlay %}dt-sc-overlay{% endif %} align-{{ section.settings.content_alignment }}"
  style="background: {{ section.settings.background_color }};"
>
  <div class="{% render 'container-settings' %}">
    <div class="row {{ section.settings.custom_class_name }}">
      {% render 'section-heading', class: section.id %}

      <div class="dt-sc-column four-column">
        {% for block in section.blocks %}
          <div class="bg-effect-{{ block.id }} gallery" style="position:relative;">
            {% unless section.settings.use_overlay_icons %}
              <a href="{% if block.settings.image != blank %}{{ block.settings.image | img_url: 'master' }}{% endif %}">
            {% endunless %}

              {% if block.settings.image != blank %}
                <img
                  class="lazyload"
                  data-src="{{ block.settings.image | img_url: 'master' }}"
                  data-widths="[180, 360, 470, 600, 770, 970, 1060, 1280, 1512, 1728, 2048]"
                  data-aspectratio="{{ block.settings.image.aspect_ratio }}"
                  data-sizes="auto"
                  alt="{{ block.settings.title | escape }}"
                >
                <noscript>
                  {{ block.settings.image | img_url: '480x480', scale: 2 | img_tag: block.settings.title, 'dt-sc-noscript-image' }}
                </noscript>
              {% else %}
                {% capture current %}{% cycle 1, 2, 3, 4, 5, 6 %}{% endcapture %}
                {{ 'image' | placeholder_svg_tag }}
              {% endif %}

              <div class="ovrly17">
                {% if section.settings.use_overlay %}
                  <div class="image-overlay">
                {% endif %}

                {% if section.settings.use_overlay_icons %}
                  <div class="links">
                    <a href="{{ block.settings.image | img_url: 'master' }}" class="gallery-pop"><i class="fa fa-search"></i></a>
                  </div>
                {% endif %}

                {% if block.settings.gallery_title != blank or block.settings.category != blank %}
                  <div class="image-overlay-details">
                    {% if block.settings.gallery_title != blank %}
                      <h4><a href="{{ block.settings.gallery_link }}">{{ block.settings.gallery_title }}</a></h4>
                    {% endif %}
                    {% if block.settings.category != blank %}
                      <p>{{ block.settings.category }}</p>
                    {% endif %}
                  </div>
                {% endif %}

                {% if section.settings.use_overlay %}
                  </div>
                {% endif %}
              </div>

            {% unless section.settings.use_overlay_icons %}
              </a>
            {% endunless %}
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
</section>

<style>
  /* --- Spacing from settings --- */
  #shopify-section-{{ section.id }} .gallery_page .row {
    margin-top: {{ margin_top }}px;
    margin-bottom: {{ margin_bottom }}px;
    padding-top: {{ padding_top }}px;
    padding-bottom: {{ padding_bottom }}px;
  }
  @media (max-width: 1199px){
    #shopify-section-{{ section.id }} .gallery_page .row {
      margin-top: {{ margin_top | divided_by: 2 }}px;
      margin-bottom: {{ margin_bottom | divided_by: 2 }}px;
      padding-top: {{ padding_top | divided_by: 2 }}px;
      padding-bottom: {{ padding_bottom | divided_by: 2 }}px;
    }
  }

  /* --- Section-wide CSS variables --- */
  #gallery-{{ section.id }}{
    /* lets tiles pick up a fixed ratio when selected */
    --tile-ratio: {% if section.settings.tile_aspect_ratio == 'auto' or section.settings.tile_aspect_ratio == blank %}auto{% else %}{{ section.settings.tile_aspect_ratio }}{% endif %};
  }

  /* --- Heading colors from settings --- */
  #gallery-{{ section.id }} .dt-sc-heading .dt-sc-main-heading { color: {{ section.settings.section_heading_color }}; }
  #gallery-{{ section.id }} .dt-sc-heading .dt-sc-sub-heading { color: {{ section.settings.section_sub_heading_color }}; }
  #gallery-{{ section.id }} .dt-sc-heading .dt-sc-heading-description { color: {{ section.settings.section_description_color }}; }
  #gallery-{{ section.id }} .dt-sc-heading .dt-sc-btn {
    background: {{ section.settings.section_button_bg_color }};
    color: {{ section.settings.section_button_text_color }};
    width: 100%;
  }
  #gallery-{{ section.id }} .dt-sc-heading .dt-sc-btn:hover {
    background: {{ section.settings.section_button_hover_bg_color }};
    color: {{ section.settings.section_button_hover_text_color }};
  }

  /* --- Optional section overlay color (if enabled) --- */
  #gallery-{{ section.id }}.dt-sc-overlay:before {
    color: {{ section.settings.background_color }};
    background: currentcolor;
    opacity: {{ section.settings.overlay_transparency | default: 0.5 }};
  }

  /* --- Grid gap (use your theme defaults, just ensure some gap) --- */
  #gallery-{{ section.id }} .dt-sc-column { grid-gap: 30px; }

  /* --- Make alignment affect headings and overlay labels --- */
  #gallery-{{ section.id }}.align-left   .dt-sc-heading,
  #gallery-{{ section.id }}.align-left   .image-overlay-details { text-align: left; }
  #gallery-{{ section.id }}.align-center .dt-sc-heading,
  #gallery-{{ section.id }}.align-center .image-overlay-details { text-align: center; }
  #gallery-{{ section.id }}.align-right  .dt-sc-heading,
  #gallery-{{ section.id }}.align-right  .image-overlay-details { text-align: right; }

  /* --- Make alignment visibly affect images via crop focus --- */
  #gallery-{{ section.id }} .gallery { position: relative; overflow: hidden; }
  {% unless section.settings.tile_aspect_ratio == 'auto' or section.settings.tile_aspect_ratio == blank %}
  #gallery-{{ section.id }} .gallery { aspect-ratio: var(--tile-ratio); }
  {% endunless %}

  #gallery-{{ section.id }} .gallery img{
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;      /* enables cropping */
    object-position: center;/* default */
  }
  #gallery-{{ section.id }}.align-left  .gallery img  { object-position: left center; }
  #gallery-{{ section.id }}.align-center .gallery img { object-position: center center; }
  #gallery-{{ section.id }}.align-right .gallery img  { object-position: right center; }

  /* --- Overlay styling & icons --- */
  .gallery_page .image-overlay .links i{ font-weight: 800; }
  .gallery_page img{ width:100%; }
  #gallery-{{ section.id }} .gallery .image-overlay{ background: {{ section.settings.img_overlay | color_modify: 'alpha', 0.7 }}; }
  #gallery-{{ section.id }} .gallery:hover .image-overlay { opacity: 1; }

  #gallery-{{ section.id }} .image-overlay .links{
    position: absolute; inset: 0;
    margin: 0 auto;
    display: flex; align-items: center; justify-content: center; text-align: center;
  }
  #gallery-{{ section.id }} .gallery .links a{
    background: {{ section.settings.img_overlay_icon_bg1 }};
    color: {{ section.settings.img_overlay_icon_txt }};
    padding: 20px; clip-path: circle(); opacity: 0; transition: opacity .25s ease;
  }
  #gallery-{{ section.id }} .gallery:hover .links a{ opacity: 1; }
  #gallery-{{ section.id }} .gallery .links a:hover{
    background: {{ section.settings.img_overlay_icon_bg }};
    color: {{ section.settings.img_overlay_icon_hover_txt }};
  }

  #gallery-{{ section.id }} .gallery .image-overlay-details h4 a { color: {{ section.settings.img_overlay_title }}; }
  #gallery-{{ section.id }} .gallery .image-overlay-details p     { color: {{ section.settings.img_overlay_catgry }}; }

  @media (max-width: 1199px){
    .gallery_page img{ width:100%; }
  }
</style>

{% javascript %}
  $('.gallery-pop').magnificPopup({
    type: 'image',
    closeOnContentClick: true,
    mainClass: 'mfp-img-mobile',
    image: { verticalFit: true }
  });
{% endjavascript %}

{% schema %}
{
  "name": "Gallery",
  "max_blocks": 100,
  "settings": [
    { "type": "checkbox", "id": "full", "label": "Show Full width" },
    { "type": "checkbox", "id": "spacing_both_ends", "label": "Enable Right & Left Spacing (Works only on Fullwidth)", "default": false },

    { "type": "text", "id": "padding", "label": "Style value (Padding)", "default": "0,0", "info": "Top(px),Bottom(px)" },
    { "type": "text", "id": "margin", "label": "Style value (Margin)", "default": "0,0", "info": "Top(px),Bottom(px)" },

    { "type": "header", "content": "Layout & Colors" },
    { "type": "color", "id": "background_color", "label": "Section background color", "default": "#ffffff" },
    { "type": "select", "id": "content_alignment", "label": "Content alignment", "default": "center",
      "options": [
        { "value": "left",   "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right",  "label": "Right" }
      ]
    },
    { "type": "select", "id": "tile_aspect_ratio", "label": "Tile aspect ratio", "default": "auto",
      "options": [
        { "value": "auto", "label": "Auto (image height)" },
        { "value": "1/1", "label": "1:1 (square)" },
        { "value": "4/3", "label": "4:3" },
        { "value": "16/9", "label": "16:9" },
        { "value": "3/4", "label": "3:4" },
        { "value": "4/5", "label": "4:5" }
      ]
    },

    { "type": "header", "content": "Heading content" },
    { "type": "text", "id": "section_heading", "label": "Main Heading", "default": "Isotope gallery" },
    { "type": "text", "id": "section_sub_heading", "label": "Sub Heading", "default": "Sub Heading" },
    { "type": "text", "id": "section_description", "label": "Description", "default": "Use this text to share the information which you like!." },
    { "type": "text", "id": "section_button_text", "label": "Link text" },
    { "type": "url", "id": "section_button_link", "label": "Link URL" },

    { "type": "header", "content": "Heading colors" },
    { "type": "color", "id": "section_heading_color", "label": "Heading color" },
    { "type": "color", "id": "section_sub_heading_color", "label": "Sub heading color" },
    { "type": "color", "id": "section_description_color", "label": "Description color" },
    { "type": "color", "id": "section_button_bg_color", "label": "Button bg color" },
    { "type": "color", "id": "section_button_text_color", "label": "Button text color" },
    { "type": "color", "id": "section_button_hover_bg_color", "label": "Button hover bg color" },
    { "type": "color", "id": "section_button_hover_text_color", "label": "Button hover text color" },

    { "type": "header", "content": "Image overlay" },
    { "type": "checkbox", "id": "enable_overlay", "label": "Enable background overlay (uses color below)", "default": false },
    { "type": "text", "id": "overlay_transparency", "label": "Overlay Transparency (0.01 to 1)", "default": "0.5" },

    { "type": "checkbox", "id": "use_overlay", "label": "Use tile overlay color", "default": true },
    { "type": "color", "id": "img_overlay", "label": "Tile overlay color", "default": "#000000" },
    { "type": "color", "id": "img_overlay_title", "label": "Overlay Title", "default": "#ffffff" },
    { "type": "color", "id": "img_overlay_catgry", "label": "Overlay Category", "default": "#ffffff" },

    { "type": "checkbox", "id": "use_overlay_icons", "label": "Show overlay zoom icon", "default": true },
    { "type": "color", "id": "img_overlay_icon_bg1", "label": "Icon background", "default": "#ffffff" },
    { "type": "color", "id": "img_overlay_icon_txt", "label": "Icon text", "default": "#111111" },
    { "type": "color", "id": "img_overlay_icon_bg", "label": "Icon hover bg", "default": "#111111" },
    { "type": "color", "id": "img_overlay_icon_hover_txt", "label": "Icon hover text", "default": "#ffffff" }
  ],
  "blocks": [
    {
      "type": "Image",
      "name": "Gallery",
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Image", "info": "Size: 650x760" },
        { "type": "text", "id": "title", "label": "Alt Text", "default": "Collection Name" },
        { "type": "text", "id": "gallery_title", "label": "Title" },
        { "type": "text", "id": "category", "label": "Category" },
        { "type": "url", "id": "gallery_link", "label": "Link" }
      ]
    }
  ],
  "presets": [
    { "name": "Gallery" }
  ]
}
{% endschema %}
