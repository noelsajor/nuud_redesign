<!-- Features Section with Seamless Animated Waves + Perfect Marquee (No max-width container) -->
<section class="features-wave-section {% if section.settings.animate_waves %}waves-animated{% endif %}" 
         role="region"
         aria-labelledby="features-title"
         style="background: {% if section.settings.use_gradient %}{{ section.settings.background_gradient }}{% else %}{{ section.settings.background_color }}{% endif %}; 
                padding: {{ section.settings.section_padding_top }}px 20px {{ section.settings.section_padding_bottom }}px 20px;
                {% if section.settings.animate_waves %}--wave-speed: {{ section.settings.wave_speed }}s; --wave-bob: {{ section.settings.wave_bob }}px;{% endif %}">

  {%- comment -%} --------- TOP WAVE (seamless loop) --------- {%- endcomment -%}
  {% if section.settings.show_top_wave %}
  <div class="wave-top" 
       style="top: -{{ section.settings.wave_overlap_top }}px; height: {{ section.settings.wave_overlap_top }}px;"
       aria-hidden="true">
    <svg viewBox="0 0 1440 100" fill="none" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none" role="presentation" focusable="false">
      {% assign freq = section.settings.wave_frequency %}
      {% assign amp  = section.settings.wave_amplitude %}

      {%- capture wave_path_top -%}
        {% if freq == 1 %}
          {% case section.settings.wave_shape %}
            {% when 'gentle' %}<path d="M0,100 L0,{{ 100 | minus: amp | plus: 10 }} Q720,{{ 100 | minus: amp | minus: amp | plus: 10 }} 1440,{{ 100 | minus: amp | plus: 10 }} L1440,100 Z" fill="{{ section.settings.wave_color }}"/>
            {% when 'medium' %}<path d="M0,100 L0,{{ 100 | minus: amp }} Q720,{{ 100 | minus: amp | minus: amp }} 1440,{{ 100 | minus: amp }} L1440,100 Z" fill="{{ section.settings.wave_color }}"/>
            {% when 'dramatic' %}<path d="M0,100 L0,{{ 100 | minus: amp | minus: 10 }} Q720,{{ 100 | minus: amp | minus: amp | minus: 20 }} 1440,{{ 100 | minus: amp | minus: 10 }} L1440,100 Z" fill="{{ section.settings.wave_color }}"/>
            {% when 'sharp' %}<path d="M0,100 L0,{{ 100 | minus: amp }} L720,{{ 100 | minus: amp | minus: amp }} L1440,{{ 100 | minus: amp }} L1440,100 Z" fill="{{ section.settings.wave_color }}"/>
            {% when 'rounded' %}<path d="M0,100 L0,{{ 100 | minus: amp | plus: 5 }} C480,{{ 100 | minus: amp | minus: amp | plus: 5 }} 960,{{ 100 | minus: amp | minus: amp | plus: 5 }} 1440,{{ 100 | minus: amp | plus: 5 }} L1440,100 Z" fill="{{ section.settings.wave_color }}"/>
          {% endcase %}
        {% elsif freq == 2 %}
          {% case section.settings.wave_shape %}
            {% when 'gentle' %}<path d="M0,100 L0,{{ 100 | minus: amp | plus: 10 }} Q360,{{ 100 | minus: amp | minus: amp | plus: 10 }} 720,{{ 100 | minus: amp | plus: 10 }} T1440,{{ 100 | minus: amp | plus: 10 }} L1440,100 Z" fill="{{ section.settings.wave_color }}"/>
            {% when 'medium' %}<path d="M0,100 L0,{{ 100 | minus: amp }} Q360,{{ 100 | minus: amp | minus: amp }} 720,{{ 100 | minus: amp }} T1440,{{ 100 | minus: amp }} L1440,100 Z" fill="{{ section.settings.wave_color }}"/>
            {% when 'dramatic' %}<path d="M0,100 L0,{{ 100 | minus: amp | minus: 10 }} Q360,{{ 100 | minus: amp | minus: amp | minus: 20 }} 720,{{ 100 | minus: amp | minus: 10 }} T1440,{{ 100 | minus: amp | minus: 10 }} L1440,100 Z" fill="{{ section.settings.wave_color }}"/>
            {% when 'sharp' %}<path d="M0,100 L0,{{ 100 | minus: amp }} L360,{{ 100 | minus: amp | minus: amp }} L720,{{ 100 | minus: amp }} L1080,{{ 100 | minus: amp | minus: amp }} L1440,{{ 100 | minus: amp }} L1440,100 Z" fill="{{ section.settings.wave_color }}"/>
            {% when 'rounded' %}<path d="M0,100 L0,{{ 100 | minus: amp | plus: 5 }} C240,{{ 100 | minus: amp | minus: amp | plus: 5 }} 480,{{ 100 | minus: amp | minus: amp | plus: 5 }} 720,{{ 100 | minus: amp | plus: 5 }} C960,{{ 100 | minus: amp | plus: amp | plus: 5 }} 1200,{{ 100 | minus: amp | plus: amp | plus: 5 }} 1440,{{ 100 | minus: amp | plus: 5 }} L1440,100 Z" fill="{{ section.settings.wave_color }}"/>
          {% endcase %}
        {% elsif freq == 3 %}
          {% case section.settings.wave_shape %}
            {% when 'gentle' %}<path d="M0,100 L0,{{ 100 | minus: amp | plus: 10 }} Q240,{{ 100 | minus: amp | minus: amp | plus: 10 }} 480,{{ 100 | minus: amp | plus: 10 }} T960,{{ 100 | minus: amp | plus: 10 }} T1440,{{ 100 | minus: amp | plus: 10 }} L1440,100 Z" fill="{{ section.settings.wave_color }}"/>
            {% when 'medium' %}<path d="M0,100 L0,{{ 100 | minus: amp }} Q240,{{ 100 | minus: amp | minus: amp }} 480,{{ 100 | minus: amp }} T960,{{ 100 | minus: amp }} T1440,{{ 100 | minus: amp }} L1440,100 Z" fill="{{ section.settings.wave_color }}"/>
            {% when 'dramatic' %}<path d="M0,100 L0,{{ 100 | minus: amp | minus: 10 }} Q240,{{ 100 | minus: amp | minus: amp | minus: 20 }} 480,{{ 100 | minus: amp | minus: 10 }} T960,{{ 100 | minus: amp | minus: 10 }} T1440,{{ 100 | minus: amp | minus: 10 }} L1440,100 Z" fill="{{ section.settings.wave_color }}"/>
            {% when 'sharp' %}<path d="M0,100 L0,{{ 100 | minus: amp }} L240,{{ 100 | minus: amp | minus: amp }} L480,{{ 100 | minus: amp }} L720,{{ 100 | minus: amp | minus: amp }} L960,{{ 100 | minus: amp }} L1200,{{ 100 | minus: amp | minus: amp }} L1440,{{ 100 | minus: amp }} L1440,100 Z" fill="{{ section.settings.wave_color }}"/>
            {% when 'rounded' %}<path d="M0,100 L0,{{ 100 | minus: amp | plus: 5 }} C160,{{ 100 | minus: amp | minus: amp | plus: 5 }} 320,{{ 100 | minus: amp | minus: amp | plus: 5 }} 480,{{ 100 | minus: amp | plus: 5 }} C640,{{ 100 | minus: amp | plus: amp | plus: 5 }} 800,{{ 100 | minus: amp | plus: amp | plus: 5 }} 960,{{ 100 | minus: amp | plus: 5 }} C1120,{{ 100 | minus: amp | minus: amp | plus: 5 }} 1280,{{ 100 | minus: amp | minus: amp | plus: 5 }} 1440,{{ 100 | minus: amp | plus: 5 }} L1440,100 Z" fill="{{ section.settings.wave_color }}"/>
          {% endcase %}
        {% elsif freq == 4 %}
          {% case section.settings.wave_shape %}
            {% when 'gentle' %}<path d="M0,100 L0,{{ 100 | minus: amp | plus: 10 }} Q180,{{ 100 | minus: amp | minus: amp | plus: 10 }} 360,{{ 100 | minus: amp | plus: 10 }} T720,{{ 100 | minus: amp | plus: 10 }} T1080,{{ 100 | minus: amp | plus: 10 }} T1440,{{ 100 | minus: amp | plus: 10 }} L1440,100 Z" fill="{{ section.settings.wave_color }}"/>
            {% when 'medium' %}<path d="M0,100 L0,{{ 100 | minus: amp }} Q180,{{ 100 | minus: amp | minus: amp }} 360,{{ 100 | minus: amp }} T720,{{ 100 | minus: amp }} T1080,{{ 100 | minus: amp }} T1440,{{ 100 | minus: amp }} L1440,100 Z" fill="{{ section.settings.wave_color }}"/>
            {% when 'dramatic' %}<path d="M0,100 L0,{{ 100 | minus: amp | minus: 10 }} Q180,{{ 100 | minus: amp | minus: amp | minus: 20 }} 360,{{ 100 | minus: amp | minus: 10 }} T720,{{ 100 | minus: amp | minus: 10 }} T1080,{{ 100 | minus: amp | minus: 10 }} T1440,{{ 100 | minus: amp | minus: 10 }} L1440,100 Z" fill="{{ section.settings.wave_color }}"/>
            {% when 'sharp' %}<path d="M0,100 L0,{{ 100 | minus: amp }} L180,{{ 100 | minus: amp | minus: amp }} L360,{{ 100 | minus: amp }} L540,{{ 100 | minus: amp | minus: amp }} L720,{{ 100 | minus: amp }} L900,{{ 100 | minus: amp | minus: amp }} L1080,{{ 100 | minus: amp }} L1260,{{ 100 | minus: amp | minus: amp }} L1440,{{ 100 | minus: amp }} L1440,100 Z" fill="{{ section.settings.wave_color }}"/>
            {% when 'rounded' %}<path d="M0,100 L0,{{ 100 | minus: amp | plus: 5 }} C120,{{ 100 | minus: amp | minus: amp | plus: 5 }} 240,{{ 100 | minus: amp | minus: amp | plus: 5 }} 360,{{ 100 | minus: amp | plus: 5 }} C480,{{ 100 | minus: amp | plus: amp | plus: 5 }} 600,{{ 100 | minus: amp | plus: amp | plus: 5 }} 720,{{ 100 | minus: amp | plus: 5 }} C840,{{ 100 | minus: amp | minus: amp | plus: 5 }} 960,{{ 100 | minus: amp | minus: amp | plus: 5 }} 1080,{{ 100 | minus: amp | plus: 5 }} C1200,{{ 100 | minus: amp | plus: amp | plus: 5 }} 1320,{{ 100 | minus: amp | plus: amp | plus: 5 }} 1440,{{ 100 | minus: amp | plus: 5 }} L1440,100 Z" fill="{{ section.settings.wave_color }}"/>
          {% endcase %}
        {% else %}
          <path d="M0,100 L0,50 Q360,30 720,50 T1440,50 L1440,100 Z" fill="{{ section.settings.wave_color }}"/>
        {% endif %}
      {%- endcapture -%}

      <g class="wave-tiles">
        {{ wave_path_top }}
        <g transform="translate(1440,0)">{{ wave_path_top }}</g>
        <g transform="translate(2880,0)">{{ wave_path_top }}</g> <!-- third tile -->
      </g>
    </svg>
  </div>
  {% endif %}

  {%- comment -%} --------- CONTENT: PERFECT MARQUEE --------- {%- endcomment -%}
  <div class="features-container">
    {% if section.settings.section_title != blank %}
      <h2 id="features-title" class="section-title"
          style="color: {{ section.settings.title_color }}; text-align: {{ section.settings.title_alignment }};">
        {{ section.settings.section_title }}
      </h2>
    {% else %}
      <h2 id="features-title" class="sr-only">Store Features and Benefits</h2>
    {% endif %}

    {% assign dir_class = section.settings.marquee_direction | default: 'rtl' %}
    <div class="features-ticker dir-{{ dir_class }} {% if section.settings.animate_features %}ticker-animated{% endif %}"
         style="--gap: {{ section.settings.marquee_gap }}px; --ticker-speed: {{ section.settings.marquee_speed }}s;">
      <div class="ticker__track">
        <!-- Row A -->
        <ul class="ticker__row" role="list">
          {% for block in section.blocks %}
            <li class="feature-item" {{ block.shopify_attributes }}>
              <div class="feature-icon-wrapper"
                   {% if block.settings.icon_svg != blank or block.settings.icon_image %}role="img" aria-label="{{ block.settings.icon_label | default: block.settings.feature_text }}"{% endif %}>
                {% if block.settings.icon_svg != blank %}
                  <div class="feature-icon" style="color: {{ block.settings.icon_color }};" aria-hidden="true">{{ block.settings.icon_svg }}</div>
                {% elsif block.settings.icon_image %}
                  <div class="feature-icon-image" aria-hidden="true">
                    <img src="{{ block.settings.icon_image | image_url: width: 120 }}"
                         srcset="{{ block.settings.icon_image | image_url: width: 60 }} 60w, {{ block.settings.icon_image | image_url: width: 120 }} 120w"
                         sizes="60px" alt="{{ block.settings.icon_label | default: '' }}" width="60" height="60" loading="lazy" decoding="async">
                  </div>
                {% endif %}
              </div>

              {% if block.settings.feature_text != blank %}
              <div class="feature-text-wrapper">
                <p class="feature-text" style="color: {{ block.settings.text_color }};">
                  {{ block.settings.feature_text }}
                </p>
                {% if block.settings.feature_subtext != blank %}
                <p class="feature-subtext" style="color: {{ block.settings.subtext_color }};">
                  {{ block.settings.feature_subtext }}
                </p>
                {% endif %}
              </div>
              {% endif %}
            </li>
          {% endfor %}
        </ul>

        {% if section.settings.animate_features %}
        <!-- Row B (duplicate of A, only needed for perfect looping) -->
        <ul class="ticker__row" role="list" aria-hidden="true">
          {% for block in section.blocks %}
            <li class="feature-item">
              <div class="feature-icon-wrapper">
                {% if block.settings.icon_svg != blank %}
                  <div class="feature-icon" style="color: {{ block.settings.icon_color }};" aria-hidden="true">{{ block.settings.icon_svg }}</div>
                {% elsif block.settings.icon_image %}
                  <div class="feature-icon-image" aria-hidden="true">
                    <img src="{{ block.settings.icon_image | image_url: width: 120 }}"
                         srcset="{{ block.settings.icon_image | image_url: width: 60 }} 60w, {{ block.settings.icon_image | image_url: width: 120 }} 120w"
                         sizes="60px" alt="" width="60" height="60" loading="lazy" decoding="async">
                  </div>
                {% endif %}
              </div>

              {% if block.settings.feature_text != blank %}
              <div class="feature-text-wrapper">
                <p class="feature-text" style="color: {{ block.settings.text_color }};">
                  {{ block.settings.feature_text }}
                </p>
                {% if block.settings.feature_subtext != blank %}
                <p class="feature-subtext" style="color: {{ block.settings.subtext_color }};">
                  {{ block.settings.feature_subtext }}
                </p>
                {% endif %}
              </div>
              {% endif %}
            </li>
          {% endfor %}
        </ul>
        {% endif %}
      </div>
    </div>
  </div>

  {%- comment -%} --------- BOTTOM WAVE (seamless loop) --------- {%- endcomment -%}
  {% if section.settings.show_bottom_wave %}
  <div class="wave-bottom" 
       style="bottom: -{{ section.settings.wave_overlap_bottom }}px; height: {{ section.settings.wave_overlap_bottom }}px;"
       aria-hidden="true">
    <svg viewBox="0 0 1440 100" fill="none" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none" role="presentation" focusable="false">
      {% assign freq = section.settings.wave_frequency %}
      {% assign amp  = section.settings.wave_amplitude %}

      {%- capture wave_path_bottom -%}
        {% if freq == 1 %}
          {% case section.settings.wave_shape %}
            {% when 'gentle' %}<path d="M0,0 L0,{{ amp | minus: 10 }} Q720,{{ amp | plus: amp | minus: 10 }} 1440,{{ amp | minus: 10 }} L1440,0 Z" fill="{{ section.settings.wave_color }}"/>
            {% when 'medium' %}<path d="M0,0 L0,{{ amp }} Q720,{{ amp | plus: amp }} 1440,{{ amp }} L1440,0 Z" fill="{{ section.settings.wave_color }}"/>
            {% when 'dramatic' %}<path d="M0,0 L0,{{ amp | plus: 10 }} Q720,{{ amp | plus: amp | plus: 20 }} 1440,{{ amp | plus: 10 }} L1440,0 Z" fill="{{ section.settings.wave_color }}"/>
            {% when 'sharp' %}<path d="M0,0 L0,{{ amp }} L720,{{ amp | plus: amp }} L1440,{{ amp }} L1440,0 Z" fill="{{ section.settings.wave_color }}"/>
            {% when 'rounded' %}<path d="M0,0 L0,{{ amp | minus: 5 }} C480,{{ amp | plus: amp | minus: 5 }} 960,{{ amp | plus: amp | minus: 5 }} 1440,{{ amp | minus: 5 }} L1440,0 Z" fill="{{ section.settings.wave_color }}"/>
          {% endcase %}
        {% elsif freq == 2 %}
          {% case section.settings.wave_shape %}
            {% when 'gentle' %}<path d="M0,0 L0,{{ amp | minus: 10 }} Q360,{{ amp | plus: amp | minus: 10 }} 720,{{ amp | minus: 10 }} T1440,{{ amp | minus: 10 }} L1440,0 Z" fill="{{ section.settings.wave_color }}"/>
            {% when 'medium' %}<path d="M0,0 L0,{{ amp }} Q360,{{ amp | plus: amp }} 720,{{ amp }} T1440,{{ amp }} L1440,0 Z" fill="{{ section.settings.wave_color }}"/>
            {% when 'dramatic' %}<path d="M0,0 L0,{{ amp | plus: 10 }} Q360,{{ amp | plus: amp | plus: 20 }} 720,{{ amp | plus: 10 }} T1440,{{ amp | plus: 10 }} L1440,0 Z" fill="{{ section.settings.wave_color }}"/>
            {% when 'sharp' %}<path d="M0,0 L0,{{ amp }} L360,{{ amp | plus: amp }} L720,{{ amp }} L1080,{{ amp | plus: amp }} L1440,{{ amp }} L1440,0 Z" fill="{{ section.settings.wave_color }}"/>
            {% when 'rounded' %}<path d="M0,0 L0,{{ amp | minus: 5 }} C240,{{ amp | plus: amp | minus: 5 }} 480,{{ amp | plus: amp | minus: 5 }} 720,{{ amp | minus: 5 }} C960,{{ amp | minus: amp | minus: 5 }} 1200,{{ amp | minus: amp | minus: 5 }} 1440,{{ amp | minus: 5 }} L1440,0 Z" fill="{{ section.settings.wave_color }}"/>
          {% endcase %}
        {% elsif freq == 3 %}
          {% case section.settings.wave_shape %}
            {% when 'gentle' %}<path d="M0,0 L0,{{ amp | minus: 10 }} Q240,{{ amp | plus: amp | minus: 10 }} 480,{{ amp | minus: 10 }} T960,{{ amp | minus: 10 }} T1440,{{ amp | minus: 10 }} L1440,0 Z" fill="{{ section.settings.wave_color }}"/>
            {% when 'medium' %}<path d="M0,0 L0,{{ amp }} Q240,{{ amp | plus: amp }} 480,{{ amp }} T960,{{ amp }} T1440,{{ amp }} L1440,0 Z" fill="{{ section.settings.wave_color }}"/>
            {% when 'dramatic' %}<path d="M0,0 L0,{{ amp | plus: 10 }} Q240,{{ amp | plus: amp | plus: 20 }} 480,{{ amp | plus: 10 }} T960,{{ amp | plus: 10 }} T1440,{{ amp | plus: 10 }} L1440,0 Z" fill="{{ section.settings.wave_color }}"/>
            {% when 'sharp' %}<path d="M0,0 L0,{{ amp }} L240,{{ amp | plus: amp }} L480,{{ amp }} L720,{{ amp | plus: amp }} L960,{{ amp }} L1200,{{ amp | plus: amp }} L1440,{{ amp }} L1440,0 Z" fill="{{ section.settings.wave_color }}"/>
            {% when 'rounded' %}<path d="M0,0 L0,{{ amp | minus: 5 }} C160,{{ amp | plus: amp | minus: 5 }} 320,{{ amp | plus: amp | minus: 5 }} 480,{{ amp | minus: 5 }} C640,{{ amp | minus: amp | minus: 5 }} 800,{{ amp | minus: amp | minus: 5 }} 960,{{ amp | minus: 5 }} C1120,{{ amp | plus: amp | minus: 5 }} 1280,{{ amp | plus: amp | minus: 5 }} 1440,{{ amp | minus: 5 }} L1440,0 Z" fill="{{ section.settings.wave_color }}"/>
          {% endcase %}
        {% elsif freq == 4 %}
          {% case section.settings.wave_shape %}
            {% when 'gentle' %}<path d="M0,0 L0,{{ amp | minus: 10 }} Q180,{{ amp | plus: amp | minus: 10 }} 360,{{ amp | minus: 10 }} T720,{{ amp | minus: 10 }} T1080,{{ amp | minus: 10 }} T1440,{{ amp | minus: 10 }} L1440,0 Z" fill="{{ section.settings.wave_color }}"/>
            {% when 'medium' %}<path d="M0,0 L0,{{ amp }} Q180,{{ amp | plus: amp }} 360,{{ amp }} T720,{{ amp }} T1080,{{ amp }} T1440,{{ amp }} L1440,0 Z" fill="{{ section.settings.wave_color }}"/>
            {% when 'dramatic' %}<path d="M0,0 L0,{{ amp | plus: 10 }} Q180,{{ amp | plus: amp | plus: 20 }} 360,{{ amp | plus: 10 }} T720,{{ amp | plus: 10 }} T1080,{{ amp | plus: 10 }} T1440,{{ amp | plus: 10 }} L1440,0 Z" fill="{{ section.settings.wave_color }}"/>
            {% when 'sharp' %}<path d="M0,0 L0,{{ amp }} L180,{{ amp | plus: amp }} L360,{{ amp }} L540,{{ amp | plus: amp }} L720,{{ amp }} L900,{{ amp | plus: amp }} L1080,{{ amp }} L1260,{{ amp | plus: amp }} L1440,{{ amp }} L1440,0 Z" fill="{{ section.settings.wave_color }}"/>
            {% when 'rounded' %}<path d="M0,0 L0,{{ amp | minus: 5 }} C120,{{ amp | plus: amp | minus: 5 }} 240,{{ amp | plus: amp | minus: 5 }} 360,{{ amp | minus: 5 }} C480,{{ amp | minus: amp | minus: 5 }} 600,{{ amp | minus: amp | minus: 5 }} 720,{{ amp | minus: 5 }} C840,{{ amp | plus: amp | minus: 5 }} 960,{{ amp | plus: amp | minus: 5 }} 1080,{{ amp | minus: 5 }} C1200,{{ amp | minus: amp | minus: 5 }} 1320,{{ amp | minus: amp | minus: 5 }} 1440,{{ amp | minus: 5 }} L1440,0 Z" fill="{{ section.settings.wave_color }}"/>
          {% endcase %}
        {% else %}
          <path d="M0,0 L0,50 Q360,70 720,50 T1440,50 L1440,0 Z" fill="{{ section.settings.wave_color }}"/>
        {% endif %}
      {%- endcapture -%}

      <g class="wave-tiles">
        {{ wave_path_bottom }}
        <g transform="translate(1440,0)">{{ wave_path_bottom }}</g>
        <g transform="translate(2880,0)">{{ wave_path_bottom }}</g> <!-- third tile -->
      </g>
    </svg>
  </div>
  {% endif %}
</section>

<style>
/* Base Section */
.features-wave-section { position: relative; overflow: visible; z-index: 1; font-family: inherit; }

/* Waves */
.wave-top, .wave-bottom {
  position: absolute; left: 0; width: 100%; line-height: 0; pointer-events: none; z-index: 2; overflow: visible;
}
.wave-top svg, .wave-bottom svg { width: 100%; height: 100%; display: block; }

/* Seamless wave loop (3 tiles, slide by -33.333%) */
.features-wave-section.waves-animated .wave-top .wave-tiles,
.features-wave-section.waves-animated .wave-bottom .wave-tiles{
  animation: waveSlide var(--wave-speed, 8s) linear infinite;
  will-change: transform;
  backface-visibility: hidden;
  transform: translate3d(0,0,0);
  transform-box: view-box;
  transform-origin: 0 50%;
}

/* Slight vertical bob for life */
.features-wave-section.waves-animated .wave-top,
.features-wave-section.waves-animated .wave-bottom{
  animation: waveBob var(--wave-speed, 8s) ease-in-out infinite alternate;
}

/* Move exactly one tile of a 3-tile track (1/3 of width) + tiny over-travel to hide seams */
@keyframes waveSlide{
  from { transform: translateX(0); }
  to   { transform: translateX(calc(-33.333333% - 0.1px)); }
}

/* Vertical bob */
@keyframes waveBob{ from{ transform: translateY(0); } to{ transform: translateY(var(--wave-bob, 8px)); } }

/* Container — no max-width */
.features-container { position: relative; z-index: 3; margin: 0 auto !important; width: 100%; max-width: none !important; }

/* Section Title */
.section-title { margin: 0 0 32px 0; line-height: 1.2; font-family: inherit; }

/* ---------- PERFECT MARQUEE ---------- */
.features-ticker{
  overflow: hidden;
  width: 100%;
  --gap: 40px;
  --ticker-speed: 20s;
  contain: layout paint;
}
.ticker__track{
  display: flex;
  justify-content: center;
  flex-wrap: nowrap;
  width: max-content;
  will-change: transform;
  backface-visibility: hidden;
  transform: translate3d(0,0,0);
  animation: none; /* applied only when .ticker-animated is present */
}
.ticker-animated .ticker__track{ animation: marquee var(--ticker-speed) linear infinite; }
.features-ticker.dir-ltr.ticker-animated .ticker__track{ animation-direction: reverse; } /* left → right */
.features-ticker.dir-rtl.ticker-animated .ticker__track{ animation-direction: normal; }  /* right → left */

/* Each row = one full set of features; duplicating 2x makes -50% a perfect loop point */
.ticker__row{
  flex: none;
  display: flex;
  align-items: center;
  gap: var(--gap);
  padding-right: var(--gap);
  white-space: nowrap;
}

/* Static fallback when animation is disabled */
.features-ticker:not(.ticker-animated) .ticker__track{ width: 100%; }
.features-ticker:not(.ticker-animated) .ticker__row{
  justify-content: center;
  flex-wrap: wrap;
  white-space: normal;
  padding-right: 0;
}

/* Items */
.feature-item{ display: inline-flex; align-items: center; gap: 12px; margin: 0; }
.feature-icon-wrapper{ flex-shrink:0; }
.feature-icon, .feature-icon-image{ width:60px; height:60px; display:flex; align-items:center; justify-content:center; }
.feature-icon svg{ width:100%; height:100%; display:block; }
.feature-icon-image img{ max-width:100%; max-height:100%; object-fit:contain; display:block; }
.feature-text-wrapper{ min-width:0; }
.feature-text, .feature-subtext{ margin:0; line-height:1.4; font-family: inherit; }
.feature-subtext{ margin-top:4px; }

/* The marquee track moves by half its width (two rows) */
@keyframes marquee{
  from { transform: translate3d(0,0,0); }
  to   { transform: translate3d(-50%,0,0); }
}

/* Hover pause (optional via setting) */
{% if section.settings.marquee_pause %}
.ticker-animated:hover .ticker__track{ animation-play-state: paused; }
{% endif %}

/* Respect user motion preferences */
@media (prefers-reduced-motion: reduce){
  .ticker__track,
  .features-wave-section.waves-animated .wave-top .wave-tiles,
  .features-wave-section.waves-animated .wave-bottom .wave-tiles,
  .features-wave-section.waves-animated .wave-top,
  .features-wave-section.waves-animated .wave-bottom{
    animation: none !important;
    transform: none !important;
  }
}

/* Responsive */
@media (max-width: 768px){
  .section-title{ margin-bottom: 24px; }
  .feature-icon, .feature-icon-image{ width:48px; height:48px; }
  .ticker__row{ flex-direction: column; gap: 40px; }
  .ticker__row li{ flex-direction: column; gap: 0; }
}
@media (max-width: 480px){
  .features-ticker{ --gap: {{ section.settings.marquee_gap | default: 40 | times: 0.7 }}px; }
}

/* Print */
@media print{
  .features-wave-section{ background:white !important; }
  .wave-top, .wave-bottom{ display:none; }
  .ticker__track{ animation:none !important; transform:none !important; }
}
</style>

{% schema %}
{
  "name": "Features with Waves",
  "settings": [
    { "type": "header", "content": "Section Layout" },
    { "type": "checkbox", "id": "use_gradient", "label": "Use Gradient Background", "default": true },
    { "type": "color", "id": "background_color", "label": "Background Color", "default": "#ffc4e1" },
    { "type": "color_background", "id": "background_gradient", "label": "Background Gradient", "default": "linear-gradient(135deg, #ffc4e1 0%, #b4d5ff 100%)" },
    { "type": "range", "id": "section_padding_top", "label": "Padding Top", "min": 0, "max": 250, "step": 10, "default": 80, "unit": "px" },
    { "type": "range", "id": "section_padding_bottom", "label": "Padding Bottom", "min": 0, "max": 250, "step": 10, "default": 80, "unit": "px" },

    { "type": "header", "content": "Section Title (Optional)" },
    { "type": "text", "id": "section_title", "label": "Section Title" },
    { "type": "color", "id": "title_color", "label": "Title Color", "default": "#8b1538" },
    { "type": "range", "id": "title_size", "label": "Title Font Size", "min": 20, "max": 48, "step": 2, "default": 32, "unit": "px" },
    { "type": "select", "id": "title_alignment", "label": "Title Alignment", "options": [
      { "value": "left", "label": "Left" }, { "value": "center", "label": "Center" }, { "value": "right", "label": "Right" }
    ], "default": "center" },

    { "type": "header", "content": "Wave Settings" },
    { "type": "select", "id": "wave_shape", "label": "Wave Shape", "options": [
      { "value": "gentle", "label": "Gentle - Subtle curves" },
      { "value": "medium", "label": "Medium - Balanced waves" },
      { "value": "dramatic", "label": "Dramatic - Deep curves" },
      { "value": "sharp", "label": "Sharp - Angular peaks" },
      { "value": "rounded", "label": "Rounded - Smooth arcs" }
    ], "default": "medium" },
    { "type": "checkbox", "id": "show_top_wave", "label": "Show Top Wave", "default": true },
    { "type": "checkbox", "id": "show_bottom_wave", "label": "Show Bottom Wave", "default": true },
    { "type": "color", "id": "wave_color", "label": "Wave Color", "default": "#ffd4e5" },
    { "type": "range", "id": "wave_overlap_top", "label": "Top Wave Height", "min": 20, "max": 200, "step": 10, "default": 100, "unit": "px" },
    { "type": "range", "id": "wave_overlap_bottom", "label": "Bottom Wave Height", "min": 20, "max": 200, "step": 10, "default": 100, "unit": "px" },
    { "type": "range", "id": "wave_frequency", "label": "Wave Frequency", "min": 1, "max": 4, "step": 1, "default": 2 },
    { "type": "range", "id": "wave_amplitude", "label": "Wave Amplitude", "min": 10, "max": 40, "step": 5, "default": 25 },

    { "type": "header", "content": "Wave Animation" },
    { "type": "checkbox", "id": "animate_waves", "label": "Animate Waves", "default": true },
    { "type": "range", "id": "wave_speed", "label": "Loop Speed (seconds per cycle)", "min": 2, "max": 30, "step": 1, "default": 12, "unit": "s" },
    { "type": "range", "id": "wave_bob", "label": "Vertical Bob (px)", "min": 0, "max": 30, "step": 1, "default": 8, "unit": "px" },

    { "type": "header", "content": "Content Marquee" },
    { "type": "checkbox", "id": "animate_features", "label": "Animate Features Marquee", "default": true },
    { "type": "range", "id": "marquee_speed", "label": "Content Loop Speed (s)", "min": 3, "max": 60, "step": 1, "default": 20, "unit": "s" },
    { "type": "select", "id": "marquee_direction", "label": "Content Direction", "options": [
      { "value": "rtl", "label": "Right → Left" },
      { "value": "ltr", "label": "Left → Right" }
    ], "default": "rtl" },
    { "type": "range", "id": "marquee_gap", "label": "Space Between Items (px)", "min": 0, "max": 80, "step": 2, "default": 40 },
    { "type": "checkbox", "id": "marquee_pause", "label": "Pause marquee on hover", "default": true }
  ],
  "blocks": [
    {
      "type": "feature",
      "name": "Feature Item",
      "settings": [
        { "type": "header", "content": "Icon Settings" },
        { "type": "html", "id": "icon_svg", "label": "Icon SVG Code" },
        { "type": "image_picker", "id": "icon_image", "label": "OR Upload Icon Image" },
        { "type": "text", "id": "icon_label", "label": "Icon Description", "default": "Feature icon" },
        { "type": "color", "id": "icon_color", "label": "Icon Color", "default": "#8b1538" },

        { "type": "header", "content": "Text Settings" },
        { "type": "text", "id": "feature_text", "label": "Feature Text", "default": "Feature description" },
        { "type": "color", "id": "text_color", "label": "Text Color", "default": "#8b1538" },
        { "type": "range", "id": "text_size", "label": "Text Size", "min": 14, "max": 24, "step": 1, "default": 18, "unit": "px" },
        { "type": "select", "id": "text_weight", "label": "Text Weight", "options": [
          { "value": "400", "label": "Normal" }, { "value": "500", "label": "Medium" }, { "value": "600", "label": "Semi Bold" }, { "value": "700", "label": "Bold" }
        ], "default": "600" },

        { "type": "header", "content": "Subtext (Optional)" },
        { "type": "text", "id": "feature_subtext", "label": "Feature Subtext" },
        { "type": "color", "id": "subtext_color", "label": "Subtext Color", "default": "#666666" },
        { "type": "range", "id": "subtext_size", "label": "Subtext Size", "min": 12, "max": 18, "step": 1, "default": 14, "unit": "px" }
      ]
    }
  ],
  "presets": [
    { "name": "Features with Waves", "category": "Custom" }
  ],
  "templates": ["index", "collection", "page", "product"]
}
{% endschema %}
