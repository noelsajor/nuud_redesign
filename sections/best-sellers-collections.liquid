<!-- Best Sellers Collection Section -->
<section class="best-sellers-section"
         role="region"
         aria-labelledby="best-sellers-title"
         style="background-color: {{ section.settings.background_color }}; 
                padding: {{ section.settings.section_padding_top }}px 20px {{ section.settings.section_padding_bottom }}px 20px;">

  <div class="best-sellers-container">
    
    <!-- Badge -->
    {% if section.settings.show_badge and section.settings.badge_image %}
    <div class="collection-badge" role="img" aria-label="{{ section.settings.badge_alt | default: 'Collection Badge' }}">
      <img src="{{ section.settings.badge_image | image_url: width: 200 }}" 
           alt="{{ section.settings.badge_alt | default: 'Collection Badge' }}" 
           class="badge-image {% if section.settings.badge_spin %}badge-spin{% endif %}"
           style="width: {{ section.settings.badge_size }}px; height: {{ section.settings.badge_size }}px;"
           width="{{ section.settings.badge_size }}"
           height="{{ section.settings.badge_size }}"
           loading="lazy"
           decoding="async">
    </div>
    {% endif %}

    <!-- Inner container (background + radius + padding) -->
    <div class="best-sellers-inner{% if section.settings.enable_image_overflow %} image-overflow{% endif %}"
         style="
           background-color: {{ section.settings.container_background_color }};
           border-radius: {{ section.settings.container_border_radius }}px;
           padding: {{ section.settings.container_padding }}px;
           --image-overflow: {{ section.settings.image_overflow_amount }}px;
         ">

      <!-- Section Header -->
      <header class="section-header" 
              style="text-align: {{ section.settings.title_alignment }}; margin-bottom: {{ section.settings.title_bottom_spacing }}px;">
        {% if section.settings.section_title != blank %}
        <h2 id="best-sellers-title" 
            class="section-title"
            style="color: {{ section.settings.title_color }}; 
                   font-size: {{ section.settings.title_size }}px;
                   font-weight: {{ section.settings.title_weight }};">
          {{ section.settings.section_title }}
        </h2>
        {% endif %}
      </header>
      
      <!-- Products Grid -->
      {% if section.settings.collection != blank %}
        {% assign collection = collections[section.settings.collection] %}
        {% if collection.products.size > 0 %}
        <div class="products-grid" 
             style="grid-template-columns: repeat(auto-fit, minmax({{ section.settings.min_product_width }}px, 1fr)); gap: {{ section.settings.products_grid_gap }}px;">
          
          {% for product in collection.products limit: section.settings.products_to_show %}
          <article class="product-card" 
                   style="background-color: {{ section.settings.card_background }}; 
                          border-radius: {{ section.settings.card_border_radius }}px;">
            
            <!-- Product Image -->
            <div class="product-image-container">
              <a href="{{ product.url }}" 
                 aria-label="View {{ product.title }}"
                 class="product-link">
                {% if product.featured_image %}
                  <img src="{{ product.featured_image | image_url: width: 400 }}"
                       srcset="{{ product.featured_image | image_url: width: 200 }} 200w,
                               {{ product.featured_image | image_url: width: 300 }} 300w,
                               {{ product.featured_image | image_url: width: 400 }} 400w"
                       sizes="(max-width: 480px) 200px, (max-width: 768px) 300px, 400px"
                       alt="{{ product.featured_image.alt | default: product.title }}"
                       class="product-image"
                       width="400"
                       height="300"
                       loading="lazy"
                       decoding="async">
                {% else %}
                  <div class="product-image-placeholder" 
                       style="background-color: {{ section.settings.placeholder_color }};"
                       aria-label="No image available for {{ product.title }}">
                    <span aria-hidden="true">No Image</span>
                  </div>
                {% endif %}
                
                <!-- Product Badge/Sale -->
                {% if product.compare_at_price > product.price %}
                <span class="sale-badge" 
                      style="background-color: {{ section.settings.sale_badge_color }};"
                      aria-label="On sale">
                  Sale
                </span>
                {% endif %}
              </a>
            </div>
            
            <!-- Product Info -->
            <div class="product-info" style="padding: {{ section.settings.card_padding }}px;">
              
              <!-- Star Rating -->
              {% if section.settings.show_ratings %}
              <div class="product-rating" aria-label="5 out of 5 stars">
                {% for i in (1..5) %}
                  <span class="star" 
                        style="color: {{ section.settings.star_color }};"
                        aria-hidden="true">â˜…</span>
                {% endfor %}
              </div>
              {% endif %}
              
              <!-- Brand Name -->
              {% if section.settings.show_vendor and product.vendor %}
              <p class="product-vendor" 
                 style="color: {{ section.settings.vendor_color }}; 
                        font-size: {{ section.settings.vendor_size }}px;">
                {{ product.vendor | upcase }}
              </p>
              {% endif %}
              
              <!-- Product Title -->
              <h3 class="product-title">
                <a href="{{ product.url }}" 
                   style="color: {{ section.settings.product_title_color }}; 
                          font-size: {{ section.settings.product_title_size }}px;
                          font-weight: {{ section.settings.product_title_weight }};">
                  {{ product.title }}
                </a>
              </h3>
              
              <!-- Add to Cart Button -->
              <form action="/cart/add" method="post" enctype="multipart/form-data" class="product-form">
                {% unless product.has_only_default_variant %}
                  <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                {% else %}
                  <input type="hidden" name="id" value="{{ product.variants.first.id }}">
                {% endunless %}
                
                <button type="submit" 
                        class="add-to-cart-btn {% unless product.available %}sold-out{% endunless %}"
                        style="background-color: {{ section.settings.cart_button_background }}; 
                               color: {{ section.settings.cart_button_text_color }};
                               border-radius: {{ section.settings.cart_button_radius }}px;
                               font-size: {{ section.settings.cart_button_text_size }}px;"
                        {% unless product.available %}disabled{% endunless %}
                        aria-label="Add {{ product.title }} to cart">
                  {% if product.available %}
                    {{ section.settings.add_to_cart_text | default: 'ADD TO CART' }}
                  {% else %}
                    {{ section.settings.sold_out_text | default: 'SOLD OUT' }}
                  {% endif %}
                </button>
              </form>
            </div>
          </article>
          {% endfor %}
          
        </div>
        {% else %}
        <div class="no-products-message" 
             style="text-align: center; padding: 40px; color: #666;">
          <p>No products found in this collection.</p>
        </div>
        {% endif %}
        
        <!-- See All Button (Below Products) -->
        {% if section.settings.show_see_all_button and section.settings.collection != blank %}
        <div class="see-all-container" 
             style="text-align: {{ section.settings.button_alignment }}; margin-top: {{ section.settings.button_top_spacing }}px;">
          <a href="{{ collections[section.settings.collection].url }}" 
             class="see-all-button dt-sc-btn{% if section.settings.section_button_bg_color != blank %} ctm-btn-padding{% endif %}"
             aria-label="View all products in {{ collections[section.settings.collection].title }} collection">
            {{ section.settings.see_all_text | default: 'See all' }}
            <!-- Arrow SVG identical to blog section -->
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" aria-hidden="true" focusable="false" width="36" height="36">
              <path d="M8,45h72L66.4,31.4c-1.9-1.9-1.9-5.1,0-7c1.9-1.9,5.1-1.9,7,0l22.1,22.1c0,0,0,0,0.1,0.1c0.2,0.2,0.4,0.4,0.6,0.7
                       c0.1,0.1,0.1,0.2,0.1,0.3c0.1,0.2,0.2,0.4,0.3,0.6c0,0.1,0.1,0.2,0.1,0.3c0.1,0.2,0.1,0.4,0.2,0.6c0.1,0.3,0.1,0.6,0.1,1
                       s0,0.7-0.1,1c0,0.2-0.1,0.4-0.2,0.6c0,0.1-0.1,0.2-0.1,0.3c-0.1,0.2-0.2,0.4-0.3,0.6c0,0.1-0.1,0.2-0.1,0.3
                       c-0.2,0.2-0.4,0.5-0.6,0.7c0,0,0,0,0,0.1L73.4,75.6c-1,1-2.2,1.5-3.5,1.5s-2.5-0.5-3.5-1.5c-1.9-1.9-1.9-5.1,0-7L80,55H8
                       c-2.7,0-5-2.2-5-5C3.1,47.3,5.3,45,8,45z"></path>
            </svg>
          </a>
        </div>
        {% endif %}
        
      {% else %}
      <div class="no-collection-message" 
           style="text-align: center; padding: 40px; color: #666;">
        <p>Please select a collection to display products.</p>
      </div>
      {% endif %}

    </div><!-- /.best-sellers-inner -->
    
  </div>
</section>

<style>
/* Base */
.best-sellers-section { position: relative; }
.best-sellers-container {
  position: relative;
  max-width: 960px;
  width: 100%;
  margin: 100px auto;
}
.best-sellers-inner { position: relative; overflow: visible; }

/* Badge */
.collection-badge { position: absolute; top: -30px; right: 20px; z-index: 10; }
.badge-image { border-radius: 50%; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); display: block; }
.badge-spin { animation: spin {{ section.settings.badge_spin_speed | default: 10 }}s linear infinite; }
@keyframes spin { from{transform:rotate(0)} to{transform:rotate(360deg)} }
@media (prefers-reduced-motion: reduce){ .badge-spin{ animation: none; } }

/* Typography (consistent with your other section) */
.section-title,
.product-title,
.see-all-button,
.add-to-cart-btn,
.product-vendor {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
}

/* Header */
.section-header { /* spacing via inline style */ }
.section-title { margin: 0; line-height: 1.2; font-weight: {{ section.settings.title_weight }}; }

/* Products Grid */
.products-grid { display: grid; margin-bottom: 20px; }

/* Product Card */
.product-card {
  position: relative;
  overflow: visible;
  transition: transform .3s ease, box-shadow .3s ease;
  height: 100%;
  display: flex;
  flex-direction: column;
}
.product-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,.15); }

/* Image container with optional overflow above inner container */
.product-image-container {
  position: relative;
  aspect-ratio: 1/1;
  overflow: hidden;
  background-color: #f8f8f8;
  margin-top: 0;
}
.best-sellers-inner.image-overflow .product-image-container {
  margin-top: calc(var(--image-overflow, 0px) * -1);
}

.product-link { display: block; width: 100%; height: 100%; }
.product-image { width: 100%; height: 100%; object-fit: cover; object-position: center; transition: transform .3s ease; }
.product-card:hover .product-image { transform: scale(1.05); }
.product-image-placeholder {
  width: 100%; height: 100%; display:flex; align-items:center; justify-content:center;
  color:#999; font-size:14px;
}
.sale-badge {
  position: absolute; top: 10px; left: 10px; color: #fff; padding: 5px 10px;
  border-radius: 4px; font-size: 12px; font-weight: 600; text-transform: uppercase;
}

/* Product Info */
.product-info { flex: 1; display: flex; flex-direction: column; gap: 10px; }
.product-rating { display:flex; gap:2px; font-size:14px; margin-bottom:5px; }
.product-vendor { margin: 0; font-size: 12px; font-weight: 600; letter-spacing: .5px; }
.product-title { margin: 0; flex: 1; }
.product-title a {
  text-decoration: none; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;
  overflow: hidden; line-height: 1.3;
}
.product-title a:hover, .product-title a:focus { text-decoration: underline; }

/* Add to Cart */
.product-form { margin-top: auto; }
.add-to-cart-btn {
  width: 100%; border: none; padding: 12px 20px; font-weight: 600; text-transform: uppercase;
  cursor: pointer; transition: all .3s ease; letter-spacing: .5px;
}
.add-to-cart-btn:hover:not(.sold-out) { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,.2); }
.add-to-cart-btn:focus { outline: 2px solid currentColor; outline-offset: 2px; }
.add-to-cart-btn.sold-out { opacity: .6; cursor: not-allowed; }

/* ===== See All Button (match blog .dt-sc-btn) ===== */
.see-all-container { width: 100%; }

/* Use the same class and SVG behavior; path follows currentColor */
.see-all-button.dt-sc-btn { 
  display: inline-flex; align-items: center; gap: 8px;
  border: none; text-decoration: none; line-height: 1; 
  font-weight: 600; /* similar to blog */
  padding: 0; /* same as blog heading button */
  transition: background .3s ease, color .3s ease, opacity .3s ease, transform .2s ease;
  background: none;
  color: #2D0288;
}
.see-all-button.dt-sc-btn.ctm-btn-padding { padding: 6px 15px; } /* same helper used in blog */

.see-all-button.dt-sc-btn svg { display: inline-block; width: 36px; height: 36px; }
.see-all-button.dt-sc-btn svg path { fill: currentColor; }

/* Hover/focus to mirror blog behavior */
.see-all-button.dt-sc-btn:hover,
.see-all-button.dt-sc-btn:focus {
  background: none;
  color: #FF4881;
  text-decoration: none;
}
.see-all-button.dt-sc-btn:hover svg,
.see-all-button.dt-sc-btn:focus svg { transform: translateX(3px); }

/* Responsive */
@media (max-width: 768px) {
  .best-sellers-container { padding: 0 15px; }
  .collection-badge { top: -20px; right: 15px; }
  .badge-image {
    width: calc({{ section.settings.badge_size | default: 120 }}px * .8) !important;
    height: calc({{ section.settings.badge_size | default: 120 }}px * .8) !important;
  }
  .section-header { margin-bottom: 30px; }
  .section-title { font-size: calc({{ section.settings.title_size | default: 36 }}px * .8) !important; }
  .see-all-container { margin-top: 30px !important; }
  .products-grid { grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)) !important; gap: 20px; }
}
@media (max-width: 480px) {
  .products-grid { grid-template-columns: 1fr !important; }
  .section-title { font-size: calc({{ section.settings.title_size | default: 36 }}px * .7) !important; }
}
</style>

{% schema %}
{
  "name": "Best Sellers Collection",
  "class": "index-section best-sellers-section-wrapper",
  "settings": [
    {
      "type": "header",
      "content": "Collection Settings"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection",
      "info": "Select the collection to display products from"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "label": "Number of Products to Show",
      "min": 1,
      "max": 12,
      "step": 1,
      "default": 3
    },
    {
      "type": "range",
      "id": "min_product_width",
      "label": "Minimum Product Card Width",
      "info": "Controls responsive breakpoints",
      "min": 200,
      "max": 350,
      "step": 25,
      "default": 275,
      "unit": "px"
    },

    {
      "type": "header",
      "content": "Section Layout"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Section Background Color",
      "default": "#f8f8f8"
    },
    {
      "type": "range",
      "id": "section_padding_top",
      "label": "Section Padding Top",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 60,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "section_padding_bottom",
      "label": "Section Padding Bottom",
      "min": 0,
      "max": 100,
      "step": 5,
      "default": 60,
      "unit": "px"
    },

    {
      "type": "header",
      "content": "Inner Container"
    },
    {
      "type": "color",
      "id": "container_background_color",
      "label": "Container Background",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "container_border_radius",
      "label": "Container Border Radius",
      "min": 0,
      "max": 40,
      "step": 2,
      "default": 20,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "container_padding",
      "label": "Container Padding",
      "min": 0,
      "max": 60,
      "step": 5,
      "default": 20,
      "unit": "px"
    },
    {
      "type": "checkbox",
      "id": "enable_image_overflow",
      "label": "Enable image overflow above container",
      "default": true
    },
    {
      "type": "range",
      "id": "image_overflow_amount",
      "label": "Overflow amount",
      "min": 0,
      "max": 150,
      "step": 5,
      "default": 30,
      "unit": "px"
    },

    {
      "type": "header",
      "content": "Section Title"
    },
    {
      "type": "text",
      "id": "section_title",
      "label": "Section Title",
      "default": "Our Best Sellers"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title Color",
      "default": "#8b1538"
    },
    {
      "type": "range",
      "id": "title_size",
      "label": "Title Font Size",
      "min": 24,
      "max": 48,
      "step": 2,
      "default": 36,
      "unit": "px"
    },
    {
      "type": "select",
      "id": "title_weight",
      "label": "Title Font Weight",
      "options": [
        { "value": "400", "label": "Normal" },
        { "value": "500", "label": "Medium" },
        { "value": "600", "label": "Semi Bold" },
        { "value": "700", "label": "Bold" }
      ],
      "default": "700"
    },
    {
      "type": "select",
      "id": "title_alignment",
      "label": "Title Alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ],
      "default": "center"
    },
    {
      "type": "range",
      "id": "title_bottom_spacing",
      "label": "Space Below Title",
      "min": 20,
      "max": 80,
      "step": 5,
      "default": 40,
      "unit": "px"
    },

    {
      "type": "header",
      "content": "Product Grid Spacing"
    },
    {
      "type": "range",
      "id": "products_grid_gap",
      "label": "Gap Between Products",
      "min": 15,
      "max": 60,
      "step": 5,
      "default": 30,
      "unit": "px"
    },

    {
      "type": "header",
      "content": "See All Button"
    },
    {
      "type": "checkbox",
      "id": "show_see_all_button",
      "label": "Show 'See All' Button",
      "default": true
    },
    {
      "type": "text",
      "id": "see_all_text",
      "label": "Button Text",
      "default": "See all"
    },
    {
      "type": "select",
      "id": "button_alignment",
      "label": "Button Alignment",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "center", "label": "Center" },
        { "value": "right", "label": "Right" }
      ],
      "default": "center"
    },
    {
      "type": "range",
      "id": "button_top_spacing",
      "label": "Space Above Button",
      "min": 20,
      "max": 80,
      "step": 5,
      "default": 40,
      "unit": "px"
    },
    {
      "type": "color",
      "id": "section_button_bg_color",
      "label": "Button BG Color",
      "default": "#8b1538"
    },
    {
      "type": "color",
      "id": "section_button_text_color",
      "label": "Button Text Color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "section_button_hover_bg_color",
      "label": "Button Hover BG Color",
      "default": "#6f0f2c"
    },
    {
      "type": "color",
      "id": "section_button_hover_text_color",
      "label": "Button Hover Text Color",
      "default": "#ffffff"
    },

    {
      "type": "header",
      "content": "Badge Settings"
    },
    {
      "type": "checkbox",
      "id": "show_badge",
      "label": "Show Badge",
      "default": true
    },
    {
      "type": "image_picker",
      "id": "badge_image",
      "label": "Badge Image"
    },
    {
      "type": "text",
      "id": "badge_alt",
      "label": "Badge Alt Text",
      "default": "100% Fun Guaranteed"
    },
    {
      "type": "range",
      "id": "badge_size",
      "label": "Badge Size",
      "min": 80,
      "max": 150,
      "step": 10,
      "default": 120,
      "unit": "px"
    },
    {
      "type": "checkbox",
      "id": "badge_spin",
      "label": "Enable Badge Spinning",
      "default": false
    },
    {
      "type": "range",
      "id": "badge_spin_speed",
      "label": "Spin Speed (seconds)",
      "min": 5,
      "max": 20,
      "step": 1,
      "default": 10,
      "unit": "s"
    },

    {
      "type": "header",
      "content": "Product Cards"
    },
    {
      "type": "color",
      "id": "card_background",
      "label": "Card Background",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "card_border_radius",
      "label": "Card Border Radius",
      "min": 0,
      "max": 30,
      "step": 5,
      "default": 15,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "card_padding",
      "label": "Card Content Padding",
      "min": 15,
      "max": 35,
      "step": 5,
      "default": 20,
      "unit": "px"
    },
    {
      "type": "color",
      "id": "placeholder_color",
      "label": "Image Placeholder Color",
      "default": "#f0f0f0"
    },
    {
      "type": "color",
      "id": "sale_badge_color",
      "label": "Sale Badge Color",
      "default": "#ff4444"
    },

    {
      "type": "header",
      "content": "Product Information"
    },
    {
      "type": "checkbox",
      "id": "show_ratings",
      "label": "Show Star Ratings",
      "default": true
    },
    {
      "type": "color",
      "id": "star_color",
      "label": "Star Color",
      "default": "#ffc107"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Show Brand/Vendor",
      "default": true
    },
    {
      "type": "color",
      "id": "vendor_color",
      "label": "Brand Color",
      "default": "#666666"
    },
    {
      "type": "range",
      "id": "vendor_size",
      "label": "Brand Font Size",
      "min": 10,
      "max": 16,
      "step": 1,
      "default": 12,
      "unit": "px"
    },
    {
      "type": "color",
      "id": "product_title_color",
      "label": "Product Title Color",
      "default": "#333333"
    },
    {
      "type": "range",
      "id": "product_title_size",
      "label": "Product Title Size",
      "min": 14,
      "max": 20,
      "step": 1,
      "default": 16,
      "unit": "px"
    },
    {
      "type": "select",
      "id": "product_title_weight",
      "label": "Product Title Weight",
      "options": [
        { "value": "400", "label": "Normal" },
        { "value": "500", "label": "Medium" },
        { "value": "600", "label": "Semi Bold" },
        { "value": "700", "label": "Bold" }
      ],
      "default": "600"
    },

    {
      "type": "header",
      "content": "Add to Cart Button"
    },
    {
      "type": "text",
      "id": "add_to_cart_text",
      "label": "Add to Cart Text",
      "default": "ADD TO CART"
    },
    {
      "type": "text",
      "id": "sold_out_text",
      "label": "Sold Out Text",
      "default": "SOLD OUT"
    },
    {
      "type": "color",
      "id": "cart_button_background",
      "label": "Button Background",
      "default": "#ff69b4"
    },
    {
      "type": "color",
      "id": "cart_button_text_color",
      "label": "Button Text Color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "cart_button_radius",
      "label": "Button Border Radius",
      "min": 0,
      "max": 30,
      "step": 5,
      "default": 25,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "cart_button_text_size",
      "label": "Button Text Size",
      "min": 12,
      "max": 16,
      "step": 1,
      "default": 14,
      "unit": "px"
    }
  ],
  "presets": [
    {
      "name": "Best Sellers Collection",
      "category": "Custom"
    }
  ],
  "templates": ["index", "collection", "page"]
}
{% endschema %}
