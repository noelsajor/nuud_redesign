<!-- Best Sellers Collection Section (Typography aligned to reference) -->
<section class="best-sellers-section"
         aria-labelledby="best-sellers-title"
         style="
           background-color: {{ section.settings.background_color }};
           padding: {{ section.settings.section_padding_top }}px 20px {{ section.settings.section_padding_bottom }}px 20px;
         ">

  <div class="best-sellers-container">
    {% if section.settings.show_badge and section.settings.badge_image %}
      <div class="collection-badge">
        <img
          class="badge-image {% if section.settings.badge_spin %}badge-spin{% endif %}"
          src="{{ section.settings.badge_image | image_url: width: 200 }}"
          alt="{{ section.settings.badge_alt | default: 'Collection Badge' }}"
          style="width: {{ section.settings.badge_size }}px; height: {{ section.settings.badge_size }}px;"
          width="{{ section.settings.badge_size }}"
          height="{{ section.settings.badge_size }}"
          loading="lazy"
          decoding="async">
      </div>
    {% endif %}

    <!-- Section Header -->
    <header class="section-header"
            style="text-align: {{ section.settings.title_alignment }}; margin-bottom: {{ section.settings.title_bottom_spacing }}px;">
      {% if section.settings.section_title != blank %}
        <h2 id="best-sellers-title"
            class="section-title"
            style="color: {{ section.settings.title_color }}; font-size: {{ section.settings.title_size }}px; font-weight: {{ section.settings.title_weight }};">
          {{ section.settings.section_title }}
        </h2>
      {% else %}
        <h2 id="best-sellers-title" class="sr-only">Best sellers</h2>
      {% endif %}
    </header>

    <!-- Products Grid -->
    {% if section.settings.collection != blank %}
      {% assign collection = collections[section.settings.collection] %}

      {% if collection.products.size > 0 %}
        <div class="products-grid"
             role="list"
             style="grid-template-columns: repeat(auto-fit, minmax({{ section.settings.min_product_width }}px, 1fr)); gap: {{ section.settings.products_grid_gap }}px;">
          {% for product in collection.products limit: section.settings.products_to_show %}
            <article class="product-card"
                     role="listitem"
                     itemscope itemtype="https://schema.org/Product"
                     style="background-color: {{ section.settings.card_background }}; border-radius: {{ section.settings.card_border_radius }}px;">
              <meta itemprop="name" content="{{ product.title | strip_html }}" />
              {% if product.vendor %}
                <meta itemprop="brand" content="{{ product.vendor | strip_html }}" />
              {% endif %}

              <!-- Product Image -->
              <div class="product-image-container">
                <a href="{{ product.url }}" aria-label="View {{ product.title }}" class="product-link" itemprop="url">
                  {% if product.featured_image %}
                    <img
                      class="product-image"
                      src="{{ product.featured_image | image_url: width: 400 }}"
                      srcset="{{ product.featured_image | image_url: width: 200 }} 200w,
                              {{ product.featured_image | image_url: width: 300 }} 300w,
                              {{ product.featured_image | image_url: width: 400 }} 400w"
                      sizes="(max-width: 480px) 200px, (max-width: 768px) 300px, 400px"
                      alt="{{ product.featured_image.alt | default: product.title }}"
                      itemprop="image"
                      width="400"
                      height="400"
                      loading="lazy"
                      decoding="async">
                  {% else %}
                    <div class="product-image-placeholder"
                         role="img"
                         aria-label="No image available for {{ product.title }}"
                         style="background-color: {{ section.settings.placeholder_color }};">
                      <span aria-hidden="true">No Image</span>
                    </div>
                  {% endif %}

                  {% if product.compare_at_price > product.price %}
                    <span class="sale-badge"
                          style="background-color: {{ section.settings.sale_badge_color }};"
                          aria-label="On sale">Sale</span>
                  {% endif %}
                </a>
              </div>

              <!-- Product Info -->
              <div class="product-info" style="padding: {{ section.settings.card_padding }}px;">
                {% if section.settings.show_ratings %}
                  <div class="product-rating" aria-hidden="true">
                    {% for i in (1..5) %}<span class="star" style="color: {{ section.settings.star_color }};">★</span>{% endfor %}
                  </div>
                  <p class="sr-only">Rated 5 out of 5</p>
                {% endif %}

                {% if section.settings.show_vendor and product.vendor %}
                  <p class="product-vendor"
                     style="color: {{ section.settings.vendor_color }}; font-size: {{ section.settings.vendor_size }}px;">
                    {{ product.vendor | upcase }}
                  </p>
                {% endif %}

                <h3 class="product-title" itemprop="name">
                  <a href="{{ product.url }}"
                     style="color: {{ section.settings.product_title_color }};
                            font-size: {{ section.settings.product_title_size }}px;
                            font-weight: {{ section.settings.product_title_weight }};"
                     itemprop="url">
                    {{ product.title }}
                  </a>
                </h3>

                <div itemprop="offers" itemscope itemtype="https://schema.org/Offer" class="sr-only">
                  <meta itemprop="priceCurrency" content="{{ shop.currency }}" />
                  <meta itemprop="price" content="{{ product.price | divided_by: 100.0 }}" />
                  <link itemprop="availability" href="https://schema.org/{% if product.available %}InStock{% else %}OutOfStock{% endif %}" />
                  <meta itemprop="url" content="{{ product.url }}" />
                </div>

                <!-- Add to Cart -->
                <form action="/cart/add" method="post" enctype="multipart/form-data" class="product-form">
                  {% unless product.has_only_default_variant %}
                    <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                  {% else %}
                    <input type="hidden" name="id" value="{{ product.variants.first.id }}">
                  {% endunless %}

                  <button type="submit"
                          class="add-to-cart-btn {% unless product.available %}sold-out{% endunless %}"
                          style="
                            background-color: {{ section.settings.cart_button_background }};
                            color: {{ section.settings.cart_button_text_color }};
                            border-radius: {{ section.settings.cart_button_radius }}px;
                            font-size: {{ section.settings.cart_button_text_size }}px;
                          "
                          {% unless product.available %}disabled aria-disabled="true"{% endunless %}
                          aria-label="Add {{ product.title }} to cart">
                    {% if product.available %}
                      {{ section.settings.add_to_cart_text | default: 'ADD TO CART' }}
                    {% else %}
                      {{ section.settings.sold_out_text | default: 'SOLD OUT' }}
                    {% endif %}
                  </button>
                </form>
              </div>
            </article>
          {% endfor %}
        </div>
      {% else %}
        <div class="no-products-message" style="text-align: center; padding: 40px; color: #666;">
          <p>No products found in this collection.</p>
        </div>
      {% endif %}

      {% if section.settings.show_see_all_button and section.settings.collection != blank %}
        <div class="see-all-container"
             style="text-align: {{ section.settings.button_alignment }}; margin-top: {{ section.settings.button_top_spacing }}px;">
          <a href="{{ collections[section.settings.collection].url }}"
             class="see-all-button"
             style="color: {{ section.settings.button_color }}; border-color: {{ section.settings.button_color }};"
             aria-label="View all products in {{ collections[section.settings.collection].title }} collection">
            {{ section.settings.see_all_text | default: 'See All Products' }}
          </a>
        </div>
      {% endif %}
    {% else %}
      <div class="no-collection-message" style="text-align: center; padding: 40px; color: #666;">
        <p>Please select a collection to display products.</p>
      </div>
    {% endif %}
  </div>
</section>

<style>
/* ===== Typography tokens (match reference section) ===== */
.best-sellers-section{
  --font-family-sys:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;
  --lh-tight:1.2;
  --lh-normal:1.6;
  --fw-regular:400;
  --fw-medium:500;
  --fw-semibold:600;
  --fw-bold:700;
  --letter-tight:.2px;
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
}

/* ===== Utilities ===== */
.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

/* ===== Base Section ===== */
.best-sellers-section{position:relative}
.best-sellers-container{position:relative;max-width:960px;width:100%;margin:100px auto}

/* ===== Badge ===== */
.collection-badge{position:absolute;top:-30px;right:20px;z-index:10}
.badge-image{border-radius:50%;box-shadow:0 4px 15px rgba(0,0,0,.1);display:block}
.badge-spin{animation:spin {{ section.settings.badge_spin_speed | default: 10 }}s linear infinite}
@keyframes spin{from{transform:rotate(0)}to{transform:rotate(360deg)}}
@media (prefers-reduced-motion:reduce){.badge-spin{animation:none}}

/* ===== Section Header ===== */
.section-title{
  margin:0;
  font-family:var(--font-family-sys);
  line-height:var(--lh-tight);
  letter-spacing:var(--letter-tight);
}

/* ===== “See All” Button ===== */
.see-all-container{width:100%}
.see-all-button{
  display:inline-block;text-decoration:none;border-bottom:2px solid;font-weight:600;
  transition:opacity .3s ease;white-space:nowrap;
  font-family:var(--font-family-sys);line-height:var(--lh-normal);letter-spacing:.2px;
}
.see-all-button:hover,.see-all-button:focus-visible{opacity:.7;text-decoration:none;outline:2px solid currentColor;outline-offset:2px}

/* ===== Grid ===== */
.products-grid{display:grid;margin-bottom:20px}

/* ===== Product Card ===== */
.product-card{
  position:relative;overflow:hidden;height:100%;
  display:flex;flex-direction:column;
  transition:transform .3s ease,box-shadow .3s ease;
  font-family:var(--font-family-sys);
}
.product-card:hover{transform:translateY(-5px);box-shadow:0 10px 25px rgba(0,0,0,.15)}

/* ===== Product Image ===== */
.product-image-container{position:relative;aspect-ratio:1/1;overflow:hidden;background-color:#f8f8f8}
.product-link{display:block;width:100%;height:100%}
.product-image{width:100%;height:100%;object-fit:cover;object-position:center;transition:transform .3s ease}
.product-card:hover .product-image{transform:scale(1.05)}
.product-image-placeholder{width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:#999;font-size:14px}
.sale-badge{position:absolute;top:10px;left:10px;color:#fff;padding:5px 10px;border-radius:4px;font-size:12px;font-weight:600;text-transform:uppercase}

/* ===== Product Info (typography alignment) ===== */
.product-info{flex:1;display:flex;flex-direction:column;gap:10px;font-family:var(--font-family-sys)}
.product-rating{display:flex;gap:2px;font-size:14px;margin-bottom:5px;line-height:var(--lh-normal)}
.product-vendor{margin:0;font-size:12px;font-weight:600;letter-spacing:.5px;line-height:var(--lh-normal);font-family:var(--font-family-sys)}
.product-title{margin:0;flex:1;font-family:var(--font-family-sys)}
.product-title a{
  text-decoration:none;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;
  line-height:var(--lh-tight); /* matches reference headings */
}
.product-title a:hover,.product-title a:focus-visible{text-decoration:underline;outline:2px solid currentColor;outline-offset:2px}

/* ===== Add to Cart (typography aligned) ===== */
.product-form{margin-top:auto}
.add-to-cart-btn{
  width:100%;border:0;padding:12px 20px;font-weight:600;text-transform:uppercase;cursor:pointer;
  transition:transform .3s ease,box-shadow .3s ease;letter-spacing:.5px;
  font-family:var(--font-family-sys);line-height:var(--lh-normal);
}
.add-to-cart-btn:hover:not(.sold-out){transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,.2)}
.add-to-cart-btn:focus-visible{outline:2px solid currentColor;outline-offset:2px}
.add-to-cart-btn.sold-out{opacity:.6;cursor:not-allowed}

/* ===== Responsive ===== */
@media (max-width:768px){
  .best-sellers-container{padding:0 15px}
  .collection-badge{top:-20px;right:15px}
  .badge-image{width:calc({{ section.settings.badge_size | default: 120 }}px * .8)!important;height:calc({{ section.settings.badge_size | default: 120 }}px * .8)!important}
  .section-header{margin-bottom:30px}
  .section-title{font-size:calc({{ section.settings.title_size | default: 36 }}px * .8)!important}
  .see-all-container{margin-top:30px!important}
  .products-grid{grid-template-columns:repeat(auto-fit,minmax(250px,1fr))!important;gap:20px}
}
@media (max-width:480px){
  .products-grid{grid-template-columns:1fr!important}
  .section-title{font-size:calc({{ section.settings.title_size | default: 36 }}px * .7)!important}
}

/* ===== Print ===== */
@media print{
  .badge-image,.collection-badge{display:none}
  .product-card{box-shadow:none!important;transform:none!important;break-inside:avoid}
}
</style>

{% schema %}
{
  "name": "Best Sellers Collection",
  "settings": [
    { "type": "header", "content": "Collection Settings" },
    { "type": "collection", "id": "collection", "label": "Collection", "info": "Select the collection to display products from" },
    { "type": "range", "id": "products_to_show", "label": "Number of Products to Show", "min": 1, "max": 12, "step": 1, "default": 3 },

    { "type": "range", "id": "min_product_width", "label": "Minimum Product Card Width", "info": "Controls responsive breakpoints", "min": 200, "max": 350, "step": 25, "default": 275, "unit": "px" },

    { "type": "header", "content": "Section Layout" },
    { "type": "color", "id": "background_color", "label": "Background Color", "default": "#f8f8f8" },
    { "type": "range", "id": "section_padding_top", "label": "Section Padding Top", "min": 0, "max": 100, "step": 5, "default": 60, "unit": "px" },
    { "type": "range", "id": "section_padding_bottom", "label": "Section Padding Bottom", "min": 0, "max": 100, "step": 5, "default": 60, "unit": "px" },

    { "type": "header", "content": "Section Title" },
    { "type": "text", "id": "section_title", "label": "Section Title", "default": "Our Best Sellers" },
    { "type": "color", "id": "title_color", "label": "Title Color", "default": "#8b1538" },
    { "type": "range", "id": "title_size", "label": "Title Font Size", "min": 24, "max": 48, "step": 2, "default": 36, "unit": "px" },
    { "type": "select", "id": "title_weight", "label": "Title Font Weight", "options": [ { "value": "400", "label": "Normal" }, { "value": "500", "label": "Medium" }, { "value": "600", "label": "Semi Bold" }, { "value": "700", "label": "Bold" } ], "default": "700" },
    { "type": "select", "id": "title_alignment", "label": "Title Alignment", "options": [ { "value": "left", "label": "Left" }, { "value": "center", "label": "Center" }, { "value": "right", "label": "Right" } ], "default": "center" },
    { "type": "range", "id": "title_bottom_spacing", "label": "Space Below Title", "info": "Vertical spacing between title and products", "min": 20, "max": 80, "step": 5, "default": 40, "unit": "px" },

    { "type": "header", "content": "Product Grid Spacing" },
    { "type": "range", "id": "products_grid_gap", "label": "Gap Between Products", "info": "Horizontal and vertical spacing between product cards", "min": 15, "max": 60, "step": 5, "default": 30, "unit": "px" },

    { "type": "header", "content": "See All Button" },
    { "type": "checkbox", "id": "show_see_all_button", "label": "Show 'See All' Button", "default": true },
    { "type": "text", "id": "see_all_text", "label": "Button Text", "default": "See All Products" },
    { "type": "color", "id": "button_color", "label": "Button Color", "default": "#666666" },
    { "type": "select", "id": "button_alignment", "label": "Button Alignment", "options": [ { "value": "left", "label": "Left" }, { "value": "center", "label": "Center" }, { "value": "right", "label": "Right" } ], "default": "center" },
    { "type": "range", "id": "button_top_spacing", "label": "Space Above Button", "info": "Vertical spacing between products and 'See All' button", "min": 20, "max": 80, "step": 5, "default": 40, "unit": "px" },

    { "type": "header", "content": "Badge Settings" },
    { "type": "checkbox", "id": "show_badge", "label": "Show Badge", "default": true },
    { "type": "image_picker", "id": "badge_image", "label": "Badge Image" },
    { "type": "text", "id": "badge_alt", "label": "Badge Alt Text", "default": "100% Fun Guaranteed" },
    { "type": "range", "id": "badge_size", "label": "Badge Size", "min": 80, "max": 150, "step": 10, "default": 120, "unit": "px" },
    { "type": "checkbox", "id": "badge_spin", "label": "Enable Badge Spinning", "default": false },
    { "type": "range", "id": "badge_spin_speed", "label": "Spin Speed (seconds)", "min": 5, "max": 20, "step": 1, "default": 10, "unit": "s" },

    { "type": "header", "content": "Product Cards" },
    { "type": "color", "id": "card_background", "label": "Card Background", "default": "#ffffff" },
    { "type": "range", "id": "card_border_radius", "label": "Card Border Radius", "min": 0, "max": 30, "step": 5, "default": 15, "unit": "px" },
    { "type": "range", "id": "card_padding", "label": "Card Content Padding", "min": 15, "max": 35, "step": 5, "default": 20, "unit": "px" },
    { "type": "color", "id": "placeholder_color", "label": "Image Placeholder Color", "default": "#f0f0f0" },
    { "type": "color", "id": "sale_badge_color", "label": "Sale Badge Color", "default": "#ff4444" },

    { "type": "header", "content": "Product Information" },
    { "type": "checkbox", "id": "show_ratings", "label": "Show Star Ratings", "default": true },
    { "type": "color", "id": "star_color", "label": "Star Color", "default": "#ffc107" },
    { "type": "checkbox", "id": "show_vendor", "label": "Show Brand/Vendor", "default": true },
    { "type": "color", "id": "vendor_color", "label": "Brand Color", "default": "#666666" },
    { "type": "range", "id": "vendor_size", "label": "Brand Font Size", "min": 10, "max": 16, "step": 1, "default": 12, "unit": "px" },
    { "type": "color", "id": "product_title_color", "label": "Product Title Color", "default": "#333333" },
    { "type": "range", "id": "product_title_size", "label": "Product Title Size", "min": 14, "max": 20, "step": 1, "default": 16, "unit": "px" },
    { "type": "select", "id": "product_title_weight", "label": "Product Title Weight", "options": [ { "value": "400", "label": "Normal" }, { "value": "500", "label": "Medium" }, { "value": "600", "label": "Semi Bold" }, { "value": "700", "label": "Bold" } ], "default": "600" },

    { "type": "header", "content": "Add to Cart Button" },
    { "type": "text", "id": "add_to_cart_text", "label": "Add to Cart Text", "default": "ADD TO CART" },
    { "type": "text", "id": "sold_out_text", "label": "Sold Out Text", "default": "SOLD OUT" },
    { "type": "color", "id": "cart_button_background", "label": "Button Background", "default": "#ff69b4" },
    { "type": "color", "id": "cart_button_text_color", "label": "Button Text Color", "default": "#ffffff" },
    { "type": "range", "id": "cart_button_radius", "label": "Button Border Radius", "min": 0, "max": 30, "step": 5, "default": 25, "unit": "px" },
    { "type": "range", "id": "cart_button_text_size", "label": "Button Text Size", "min": 12, "max": 16, "step": 1, "default": 14, "unit": "px" }
  ],
  "presets": [
    { "name": "Best Sellers Collection", "category": "Custom" }
  ],
  "templates": ["index", "collection", "page"]
}
{% endschema %}
